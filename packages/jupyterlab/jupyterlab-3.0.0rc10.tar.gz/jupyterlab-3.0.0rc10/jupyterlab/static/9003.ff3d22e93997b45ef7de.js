(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[9003],{69003:(e,t,s)=>{"use strict";s.r(t);s.d(t,{DocumentManager:()=>W,DocumentWidgetManager:()=>b,IDocumentManager:()=>m,PathStatus:()=>k,SaveHandler:()=>x,SavingStatus:()=>N,isValidFileName:()=>u,renameDialog:()=>c,renameFile:()=>h,shouldOverwrite:()=>d});var n=s(90265);var i=s(66995);var r=s(21157);var a=s(86992);const o="jp-FileDialog";const l="jp-new-name-title";function c(e,t,s){s=s||r.nullTranslator;const a=s.load("jupyterlab");return(0,n.showDialog)({title:a.__("Rename File"),body:new g(t),focusNodeSelector:"input",buttons:[n.Dialog.cancelButton({label:a.__("Cancel")}),n.Dialog.okButton({label:a.__("Rename")})]}).then((s=>{if(!s.value){return null}if(!u(s.value)){void(0,n.showErrorMessage)(a.__("Rename Error"),Error(a.__('"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',s.value)));return null}const r=i.PathExt.dirname(t);const o=i.PathExt.join(r,s.value);return h(e,t,o)}))}function h(e,t,s){return e.rename(t,s).catch((n=>{if(n.message.indexOf("409")===-1){throw n}return d(s).then((n=>{if(n){return e.overwrite(t,s)}return Promise.reject("File not renamed")}))}))}function d(e,t){t=t||r.nullTranslator;const s=t.load("jupyterlab");const i={title:s.__("Overwrite file?"),body:s.__('"%1" already exists, overwrite?',e),buttons:[n.Dialog.cancelButton({label:s.__("Cancel")}),n.Dialog.warnButton({label:s.__("Overwrite")})]};return(0,n.showDialog)(i).then((e=>Promise.resolve(e.button.accept)))}function u(e){const t=/[\/\\:]/;return e.length>0&&!t.test(e)}class g extends a.Widget{constructor(e){super({node:_.createRenameNode(e)});this.addClass(o);const t=i.PathExt.extname(e);const s=this.inputNode.value=i.PathExt.basename(e);this.inputNode.setSelectionRange(0,s.length-t.length)}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}var _;(function(e){function t(e,t){t=t||r.nullTranslator;const s=t.load("jupyterlab");const n=document.createElement("div");const i=document.createElement("label");i.textContent=s.__("File Path");const a=document.createElement("span");a.textContent=e;const o=document.createElement("label");o.textContent=s.__("New Name");o.className=l;const c=document.createElement("input");n.appendChild(i);n.appendChild(a);n.appendChild(o);n.appendChild(c);return n}e.createRenameNode=t})(_||(_={}));var p=s(52191);const m=new p.Token("@jupyterlab/docmanager:IDocumentManager");var f=s(18834);var v=s(93269);var w=s(66934);var y=s(63117);class x{constructor(e){this._autosaveTimer=-1;this._minInterval=-1;this._interval=-1;this._isActive=false;this._inDialog=false;this._isDisposed=false;this._multiplier=10;this._context=e.context;const t=e.saveInterval||120;this._minInterval=t*1e3;this._interval=this._minInterval;this._context.fileChanged.connect(this._setTimer,this);this._context.disposed.connect(this.dispose,this)}get saveInterval(){return this._interval/1e3}set saveInterval(e){this._minInterval=this._interval=e*1e3;if(this._isActive){this._setTimer()}}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;clearTimeout(this._autosaveTimer);y.Signal.clearData(this)}start(){this._isActive=true;this._setTimer()}stop(){this._isActive=false;clearTimeout(this._autosaveTimer)}_setTimer(){clearTimeout(this._autosaveTimer);if(!this._isActive){return}this._autosaveTimer=window.setTimeout((()=>{this._save()}),this._interval)}_save(){const e=this._context;this._setTimer();if(!e){return}const t=e.contentsModel&&e.contentsModel.writable;if(!t||!e.model.dirty||this._inDialog){return}const s=(new Date).getTime();e.save().then((()=>{if(this.isDisposed){return}const e=(new Date).getTime()-s;this._interval=Math.max(this._multiplier*e,this._minInterval);this._setTimer()})).catch((e=>{if(e.message==="Cancel"){return}console.error("Error in Auto-Save",e.message)}))}}var P=s(58578);var D=s(74723);const C="jp-Document";class b{constructor(e){this._activateRequested=new y.Signal(this);this._isDisposed=false;this._registry=e.registry;this.translator=e.translator||r.nullTranslator}get activateRequested(){return this._activateRequested}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;y.Signal.disconnectReceiver(this)}createWidget(e,t){const s=e.createNew(t);this._initializeWidget(s,e,t);return s}_initializeWidget(e,t,s){M.factoryProperty.set(e,t);const n=new P.DisposableSet;(0,v.each)(this._registry.widgetExtensions(t.name),(t=>{n.add(t.createNew(e,s))}));M.disposablesProperty.set(e,n);e.disposed.connect(this._onWidgetDisposed,this);this.adoptWidget(s,e);s.fileChanged.connect(this._onFileChanged,this);s.pathChanged.connect(this._onPathChanged,this);void s.ready.then((()=>{void this.setCaption(e)}))}adoptWidget(e,t){const s=M.widgetsProperty.get(e);s.push(t);D.MessageLoop.installMessageHook(t,this);t.addClass(C);t.title.closable=true;t.disposed.connect(this._widgetDisposed,this);M.contextProperty.set(t,e)}findWidget(e,t){const s=M.widgetsProperty.get(e);if(!s){return undefined}return(0,v.find)(s,(e=>{const s=M.factoryProperty.get(e);if(!s){return false}return s.name===t}))}contextForWidget(e){return M.contextProperty.get(e)}cloneWidget(e){const t=M.contextProperty.get(e);if(!t){return undefined}const s=M.factoryProperty.get(e);if(!s){return undefined}const n=s.createNew(t,e);this._initializeWidget(n,s,t);return n}closeWidgets(e){const t=M.widgetsProperty.get(e);return Promise.all((0,v.toArray)((0,v.map)(t,(e=>this.onClose(e))))).then((()=>undefined))}deleteWidgets(e){const t=M.widgetsProperty.get(e);return Promise.all((0,v.toArray)((0,v.map)(t,(e=>this.onDelete(e))))).then((()=>undefined))}messageHook(e,t){switch(t.type){case"close-request":void this.onClose(e);return false;case"activate-request":{const t=this.contextForWidget(e);if(t){this._activateRequested.emit(t.path)}break}default:break}return true}async setCaption(e){const t=this.translator.load("jupyterlab");const s=M.contextProperty.get(e);if(!s){return}const n=s.contentsModel;if(!n){e.title.caption="";return}return s.listCheckpoints().then((r=>{if(e.isDisposed){return}const a=r[r.length-1];const o=a?i.Time.format(a.last_modified):"None";let l=t.__("Name: %1\nPath: %2\n",n.name,n.path);if(s.model.readOnly){l+=t.__("Read-only")}else{l+=t.__("Last Saved: %1\n",i.Time.format(n.last_modified))+t.__("Last Checkpoint: %1",o)}e.title.caption=l}))}async onClose(e){var t;const[s,n]=await this._maybeClose(e,this.translator);if(e.isDisposed){return true}if(s){if(!n){const s=M.contextProperty.get(e);if(!s){return true}if((t=s.contentsModel)===null||t===void 0?void 0:t.writable){await s.save()}else{await s.saveAs()}}if(e.isDisposed){return true}e.dispose()}return s}onDelete(e){e.dispose();return Promise.resolve(void 0)}_maybeClose(e,t){var s;t=t||r.nullTranslator;const i=t.load("jupyterlab");const a=M.contextProperty.get(e);if(!a){return Promise.resolve([true,true])}let o=M.widgetsProperty.get(a);if(!o){return Promise.resolve([true,true])}o=(0,v.toArray)((0,v.filter)(o,(e=>{const t=M.factoryProperty.get(e);if(!t){return false}return t.readOnly===false})));const l=M.factoryProperty.get(e);if(!l){return Promise.resolve([true,true])}const c=a.model;if(!c.dirty||o.length>1||l.readOnly){return Promise.resolve([true,true])}const h=e.title.label;const d=((s=a.contentsModel)===null||s===void 0?void 0:s.writable)?i.__("Save"):i.__("Save as");return(0,n.showDialog)({title:i.__("Save your work"),body:i.__('Save changes in "%1" before closing?',h),buttons:[n.Dialog.cancelButton({label:i.__("Cancel")}),n.Dialog.warnButton({label:i.__("Discard")}),n.Dialog.okButton({label:d})]}).then((e=>[e.button.accept,e.button.displayType==="warn"]))}_widgetDisposed(e){const t=M.contextProperty.get(e);if(!t){return}const s=M.widgetsProperty.get(t);if(!s){return}v.ArrayExt.removeFirstOf(s,e);if(!s.length){t.dispose()}}_onWidgetDisposed(e){const t=M.disposablesProperty.get(e);t.dispose()}_onFileChanged(e){const t=M.widgetsProperty.get(e);(0,v.each)(t,(e=>{void this.setCaption(e)}))}_onPathChanged(e){const t=M.widgetsProperty.get(e);(0,v.each)(t,(e=>{void this.setCaption(e)}))}}var M;(function(e){e.contextProperty=new w.AttachedProperty({name:"context",create:()=>undefined});e.factoryProperty=new w.AttachedProperty({name:"factory",create:()=>undefined});e.widgetsProperty=new w.AttachedProperty({name:"widgets",create:()=>[]});e.disposablesProperty=new w.AttachedProperty({name:"disposables",create:()=>new P.DisposableSet})})(M||(M={}));class W{constructor(e){this._activateRequested=new y.Signal(this);this._contexts=[];this._isDisposed=false;this._autosave=true;this._autosaveInterval=120;this._mode="";this.translator=e.translator||r.nullTranslator;this.registry=e.registry;this.services=e.manager;this._dialogs=e.sessionDialogs||n.sessionContextDialogs;this._opener=e.opener;this._when=e.when||e.manager.ready;const t=new b({registry:this.registry,translator:this.translator});t.activateRequested.connect(this._onActivateRequested,this);this._widgetManager=t;this._setBusy=e.setBusy}get activateRequested(){return this._activateRequested}get mode(){return this._mode}set mode(e){this._mode=e}get autosave(){return this._autosave}set autosave(e){this._autosave=e;this._contexts.forEach((t=>{const s=F.saveHandlerProperty.get(t);if(!s){return}if(e===true&&!s.isActive){s.start()}else if(e===false&&s.isActive){s.stop()}}))}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){this._autosaveInterval=e;this._contexts.forEach((t=>{const s=F.saveHandlerProperty.get(t);if(!s){return}s.saveInterval=e||120}))}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;y.Signal.clearData(this);this._contexts.forEach((e=>this._widgetManager.closeWidgets(e)));this._widgetManager.dispose();this._contexts.length=0}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map((e=>this._widgetManager.closeWidgets(e)))).then((()=>undefined))}closeFile(e){const t=this._contextsForPath(e).map((e=>this._widgetManager.closeWidgets(e)));return Promise.all(t).then((e=>undefined))}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",s){return this._createOrOpenDocument("create",e,t,s)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then((()=>this.services.contents.delete(e))).then((()=>{this._contextsForPath(e).forEach((e=>this._widgetManager.deleteWidgets(e)));return Promise.resolve(void 0)}))}findWidget(e,t="default"){const s=i.PathExt.normalize(e);let n=[t];if(t==="default"){const e=this.registry.defaultWidgetFactory(s);if(!e){return undefined}n=[e.name]}else if(t===null){n=this.registry.preferredWidgetFactories(s).map((e=>e.name))}for(const i of this._contextsForPath(s)){for(const e of n){if(e!==null){const t=this._widgetManager.findWidget(i,e);if(t){return t}}}}return undefined}newUntitled(e){if(e.type==="file"){e.ext=e.ext||".txt"}return this.services.contents.newUntitled(e)}open(e,t="default",s,n){return this._createOrOpenDocument("open",e,t,s,n)}openOrReveal(e,t="default",s,n){if(this.mode=="single-document"&&(n===null||n===void 0?void 0:n.maybeNewWorkspace)){this._openInNewWorkspace(e)}else{const i=this.findWidget(e,t);if(i){this._opener.open(i,n||{});return i}return this.open(e,t,s,n||{})}}overwrite(e,t){const s=`${t}.${p.UUID.uuid4()}`;const n=()=>this.rename(s,t);return this.rename(e,s).then((()=>this.deleteFile(t))).then(n,n)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const s=this.services.contents.normalize(e);return(0,v.find)(this._contexts,(e=>e.path===s&&e.factoryName===t))}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter((e=>e.path===t))}_createContext(e,t,s){const n=(e,t)=>{this._widgetManager.adoptWidget(r,e);this._opener.open(e,t)};const i=this.services.contents.getModelDBFactory(e)||undefined;const r=new f.Context({opener:n,manager:this.services,factory:t,path:e,kernelPreference:s,modelDBFactory:i,setBusy:this._setBusy,sessionDialogs:this._dialogs});const a=new x({context:r,saveInterval:this.autosaveInterval});F.saveHandlerProperty.set(r,a);void r.ready.then((()=>{if(this.autosave){a.start()}}));r.disposed.connect(this._onContextDisposed,this);this._contexts.push(r);return r}_onContextDisposed(e){v.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:s}=this;if(t==="default"){const n=s.defaultWidgetFactory(e);if(!n){return undefined}t=n.name}return s.getWidgetFactory(t)}_openInNewWorkspace(e){const t=i.PageConfig.getUrl({mode:this.mode,workspace:"default",treePath:e});window.open(t)}_createOrOpenDocument(e,t,s="default",n,i){const r=this._widgetFactoryFor(t,s);if(!r){return undefined}const a=r.modelName||"text";const o=this.registry.getModelFactory(a);if(!o){return undefined}const l=this.registry.getKernelPreference(t,r.name,n);let c;let h=Promise.resolve(undefined);if(e==="open"){c=this._findContext(t,o.name)||null;if(!c){c=this._createContext(t,o,l);h=this._when.then((()=>c.initialize(false)))}}else if(e==="create"){c=this._createContext(t,o,l);h=this._when.then((()=>c.initialize(true)))}else{throw new Error(`Invalid argument 'which': ${e}`)}const d=this._widgetManager.createWidget(r,c);this._opener.open(d,i||{});h.catch((e=>{d.close()}));return d}_onActivateRequested(e,t){this._activateRequested.emit(t)}}var F;(function(e){e.saveHandlerProperty=new w.AttachedProperty({name:"saveHandler",create:()=>undefined})})(F||(F={}));var T=s(77865);var S=s.n(T);var A=s(56204);function E(e){const t=e.translator||r.nullTranslator;const s=t.load("jupyterlab");return S().createElement(A.TextItem,{source:s.__("Saving %1",e.fileStatus)})}const I=2e3;class N extends n.VDomRenderer{constructor(e){super(new N.Model(e.docManager));this.translator=e.translator||r.nullTranslator}render(){if(this.model===null||this.model.status===null){return null}else{return S().createElement(E,{fileStatus:this.model.status,translator:this.translator})}}}(function(e){class t extends n.VDomModel{constructor(e){super();this._onStatusChange=(e,t)=>{this._status=t;if(this._status==="completed"){setTimeout((()=>{this._status=null;this.stateChanged.emit(void 0)}),I);this.stateChanged.emit(void 0)}else{this.stateChanged.emit(void 0)}};this._status=null;this._widget=null;this._status=null;this.widget=null;this._docManager=e}get status(){return this._status}get widget(){return this._widget}set widget(e){const t=this._widget;if(t!==null){const e=this._docManager.contextForWidget(t);if(e){e.saveState.disconnect(this._onStatusChange)}}this._widget=e;if(this._widget===null){this._status=null}else{const e=this._docManager.contextForWidget(this._widget);if(e){e.saveState.connect(this._onStatusChange)}}}}e.Model=t})(N||(N={}));function R(e){return S().createElement(A.TextItem,{source:e.name,title:e.fullPath})}class k extends n.VDomRenderer{constructor(e){super(new k.Model(e.docManager));this.node.title=this.model.path}render(){return S().createElement(R,{fullPath:this.model.path,name:this.model.name})}}(function(e){class t extends n.VDomModel{constructor(e){super();this._onTitleChange=e=>{const t=this._getAllState();this._name=e.label;this._triggerChange(t,this._getAllState())};this._onPathChange=(e,t)=>{const s=this._getAllState();this._path=t;this._name=i.PathExt.basename(t);this._triggerChange(s,this._getAllState())};this._path="";this._name="";this._widget=null;this._docManager=e}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(e){const t=this._widget;if(t!==null){const e=this._docManager.contextForWidget(t);if(e){e.pathChanged.disconnect(this._onPathChange)}else{t.title.changed.disconnect(this._onTitleChange)}}const s=this._getAllState();this._widget=e;if(this._widget===null){this._path="";this._name=""}else{const e=this._docManager.contextForWidget(this._widget);if(e){this._path=e.path;this._name=i.PathExt.basename(e.path);e.pathChanged.connect(this._onPathChange)}else{this._path="";this._name=this._widget.title.label;this._widget.title.changed.connect(this._onTitleChange)}}this._triggerChange(s,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(e,t){if(e[0]!==t[0]||e[1]!==t[1]){this.stateChanged.emit(void 0)}}}e.Model=t})(k||(k={}))}}]);