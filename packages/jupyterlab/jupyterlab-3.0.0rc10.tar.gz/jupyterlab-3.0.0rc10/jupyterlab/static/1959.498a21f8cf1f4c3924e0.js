(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1959],{71959:(e,t,s)=>{"use strict";s.r(t);s.d(t,{ILoggerRegistry:()=>p,LogConsolePanel:()=>b,LogOutputModel:()=>a,Logger:()=>u,LoggerOutputAreaModel:()=>h,LoggerRegistry:()=>g,ScrollingWidget:()=>x});var i=s(50961);var r=s(21644);var n=s(63117);var o=undefined&&undefined.__rest||function(e,t){var s={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0)s[i]=e[i];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++){if(t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r]))s[i[r]]=e[i[r]]}return s};class a extends r.OutputModel{constructor(e){super(e);this.timestamp=new Date(e.value.timestamp);this.level=e.value.level}}class l extends i.OutputAreaModel.ContentFactory{createOutputModel(e){return new a(e)}}class h extends i.OutputAreaModel{constructor(e){var{maxLength:t}=e,s=o(e,["maxLength"]);super(s);this.maxLength=t}add(e){super.add(e);this._applyMaxLength();return this.length}shouldCombine(e){const{value:t,lastModel:s}=e;const i=Math.trunc(s.timestamp.getTime()/1e3);const r=Math.trunc(t.timestamp/1e3);return i===r}get(e){return super.get(e)}get maxLength(){return this._maxLength}set maxLength(e){this._maxLength=e;this._applyMaxLength()}_applyMaxLength(){if(this.list.length>this._maxLength){this.list.removeRange(0,this.list.length-this._maxLength)}}}class u{constructor(e){this._isDisposed=false;this._contentChanged=new n.Signal(this);this._stateChanged=new n.Signal(this);this._rendermime=null;this._version=0;this._level="warning";this.source=e.source;this.outputAreaModel=new h({contentFactory:new l,maxLength:e.maxLength})}get maxLength(){return this.outputAreaModel.maxLength}set maxLength(e){this.outputAreaModel.maxLength=e}get level(){return this._level}set level(e){const t=this._level;if(t===e){return}this._level=e;this._log({output:{output_type:"display_data",data:{"text/plain":`Log level set to ${e}`}},level:"metadata"});this._stateChanged.emit({name:"level",oldValue:t,newValue:e})}get length(){return this.outputAreaModel.length}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get rendermime(){return this._rendermime}set rendermime(e){if(e!==this._rendermime){const t=this._rendermime;const s=this._rendermime=e;this._stateChanged.emit({name:"rendermime",oldValue:t,newValue:s})}}get version(){return this._version}log(e){if(c.LogLevel[e.level]<c.LogLevel[this._level]){return}let t=null;switch(e.type){case"text":t={output_type:"display_data",data:{"text/plain":e.data}};break;case"html":t={output_type:"display_data",data:{"text/html":e.data}};break;case"output":t=e.data;break;default:break}if(t){this._log({output:t,level:e.level})}}clear(){this.outputAreaModel.clear(false);this._contentChanged.emit("clear")}checkpoint(){this._log({output:{output_type:"display_data",data:{"text/html":"<hr/>"}},level:"metadata"})}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;this.clear();this._rendermime=null;n.Signal.clearData(this)}_log(e){this._version++;this.outputAreaModel.add(Object.assign(Object.assign({},e.output),{timestamp:Date.now(),level:e.level}));this._contentChanged.emit("append")}}var c;(function(e){let t;(function(e){e[e["debug"]=0]="debug";e[e["info"]=1]="info";e[e["warning"]=2]="warning";e[e["error"]=3]="error";e[e["critical"]=4]="critical";e[e["metadata"]=5]="metadata"})(t=e.LogLevel||(e.LogLevel={}))})(c||(c={}));class g{constructor(e){this._loggers=new Map;this._registryChanged=new n.Signal(this);this._isDisposed=false;this._defaultRendermime=e.defaultRendermime;this._maxLength=e.maxLength}getLogger(e){const t=this._loggers;let s=t.get(e);if(s){return s}s=new u({source:e,maxLength:this.maxLength});s.rendermime=this._defaultRendermime;t.set(e,s);this._registryChanged.emit("append");return s}getLoggers(){return Array.from(this._loggers.values())}get registryChanged(){return this._registryChanged}get maxLength(){return this._maxLength}set maxLength(e){this._maxLength=e;this._loggers.forEach((t=>{t.maxLength=e}))}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;this._loggers.forEach((e=>e.dispose()));n.Signal.clearData(this)}}var d=s(52191);const p=new d.Token("@jupyterlab/logconsole:ILoggerRegistry");var _=s(21157);var m=s(86992);var f=undefined&&undefined.__rest||function(e,t){var s={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0)s[i]=e[i];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++){if(t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r]))s[i[r]]=e[i[r]]}return s};function v(e){return e.length===0?e:e[0].toUpperCase()+e.slice(1)}class y extends m.Widget{constructor(){super();this._timestampNode=document.createElement("div");this.node.append(this._timestampNode)}set timestamp(e){this._timestamp=e;this._timestampNode.innerHTML=this._timestamp.toLocaleTimeString();this.update()}set level(e){this._level=e;this.node.dataset.logLevel=e;this.update()}update(){if(this._level!==undefined&&this._timestamp!==undefined){this.node.title=`${this._timestamp.toLocaleString()}; ${v(this._level)} level`}}}class L extends i.OutputArea{createOutputItem(e){const t=super.createOutputItem(e);if(t===null){return null}const s=t.widgets[0];s.timestamp=e.timestamp;s.level=e.level;return t}onInputRequest(e,t){return}}class w extends i.OutputArea.ContentFactory{createOutputPrompt(){return new y}}class x extends m.Widget{constructor(e){var{content:t}=e,s=f(e,["content"]);super(s);this._observer=null;this.addClass("jp-Scrolling");const i=this.layout=new m.PanelLayout;i.addWidget(t);this._content=t;this._sentinel=document.createElement("div");this.node.appendChild(this._sentinel)}get content(){return this._content}onAfterAttach(e){super.onAfterAttach(e);requestAnimationFrame((()=>{this._sentinel.scrollIntoView();this._scrollHeight=this.node.scrollHeight}));if(typeof IntersectionObserver!=="undefined"){this._observer=new IntersectionObserver((e=>{this._handleScroll(e)}),{root:this.node,threshold:1});this._observer.observe(this._sentinel)}}onBeforeDetach(e){if(this._observer){this._observer.disconnect()}}onAfterShow(e){if(this._tracking){this._sentinel.scrollIntoView()}}_handleScroll([e]){if(e.isIntersecting){this._tracking=true}else if(this.isVisible){const e=this.node.scrollHeight;if(e===this._scrollHeight){this._tracking=false}else{this._sentinel.scrollIntoView();this._scrollHeight=e;this._tracking=true}}}}class b extends m.StackedPanel{constructor(e,t){super();this._outputAreas=new Map;this._source=null;this._sourceChanged=new n.Signal(this);this._sourceDisplayed=new n.Signal(this);this._loggersWatched=new Set;this.translator=t||_.nullTranslator;this._trans=this.translator.load("jupyterlab");this._loggerRegistry=e;this.addClass("jp-LogConsolePanel");e.registryChanged.connect(((e,t)=>{this._bindLoggerSignals()}),this);this._bindLoggerSignals();this._placeholder=new m.Widget;this._placeholder.addClass("jp-LogConsoleListPlaceholder");this.addWidget(this._placeholder)}get loggerRegistry(){return this._loggerRegistry}get logger(){if(this.source===null){return null}return this.loggerRegistry.getLogger(this.source)}get source(){return this._source}set source(e){if(e===this._source){return}const t=this._source;const s=this._source=e;this._showOutputFromSource(s);this._handlePlaceholder();this._sourceChanged.emit({oldValue:t,newValue:s,name:"source"})}get sourceVersion(){const e=this.source;return e!==null?this._loggerRegistry.getLogger(e).version:null}get sourceChanged(){return this._sourceChanged}get sourceDisplayed(){return this._sourceDisplayed}onAfterAttach(e){super.onAfterAttach(e);this._updateOutputAreas();this._showOutputFromSource(this._source);this._handlePlaceholder()}onAfterShow(e){super.onAfterShow(e);if(this.source!==null){this._sourceDisplayed.emit({source:this.source,version:this.sourceVersion})}}_bindLoggerSignals(){const e=this._loggerRegistry.getLoggers();for(const t of e){if(this._loggersWatched.has(t.source)){continue}t.contentChanged.connect(((e,t)=>{this._updateOutputAreas();this._handlePlaceholder()}),this);t.stateChanged.connect(((e,t)=>{if(t.name!=="rendermime"){return}const s=`source:${e.source}`;const i=this._outputAreas.get(s);if(i){if(t.newValue){i.rendermime=t.newValue}else{i.dispose()}}}),this);this._loggersWatched.add(t.source)}}_showOutputFromSource(e){const t=e===null?"null source":`source:${e}`;this._outputAreas.forEach(((e,s)=>{var i,r;if(e.id===t){(i=e.parent)===null||i===void 0?void 0:i.show();if(e.isVisible){this._sourceDisplayed.emit({source:this.source,version:this.sourceVersion})}}else{(r=e.parent)===null||r===void 0?void 0:r.hide()}}));const s=e===null?this._trans.__("Log Console"):this._trans.__("Log: %1",e);this.title.label=s;this.title.caption=s}_handlePlaceholder(){if(this.source===null){this._placeholder.node.textContent=this._trans.__("No source selected.");this._placeholder.show()}else if(this._loggerRegistry.getLogger(this.source).length===0){this._placeholder.node.textContent=this._trans.__("No log messages.");this._placeholder.show()}else{this._placeholder.hide();this._placeholder.node.textContent=""}}_updateOutputAreas(){const e=new Set;const t=this._loggerRegistry.getLoggers();for(const i of t){const t=i.source;const s=`source:${t}`;e.add(s);if(!this._outputAreas.has(s)){const e=new L({rendermime:i.rendermime,contentFactory:new w,model:i.outputAreaModel});e.id=s;const r=new x({content:e});this.addWidget(r);this._outputAreas.set(s,e);const n=e=>{if(this.source===t&&e.isVisible){this._sourceDisplayed.emit({source:this.source,version:this.sourceVersion})}};e.outputLengthChanged.connect(n,this);n(e)}}const s=this._outputAreas.keys();for(const i of s){if(!e.has(i)){const e=this._outputAreas.get(i);e===null||e===void 0?void 0:e.dispose();this._outputAreas.delete(i)}}}}}}]);