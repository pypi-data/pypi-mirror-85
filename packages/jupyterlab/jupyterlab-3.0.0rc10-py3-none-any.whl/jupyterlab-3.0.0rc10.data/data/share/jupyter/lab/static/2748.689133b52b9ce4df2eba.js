(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[2748],{62748:(e,t,i)=>{"use strict";i.r(t);i.d(t,{CSVDelimiter:()=>C,CSVDocumentWidget:()=>P,CSVViewer:()=>k,CSVViewerFactory:()=>F,DSVModel:()=>d,GridSearchService:()=>S,TSVViewerFactory:()=>$,TextRenderConfig:()=>E,parseDSV:()=>a,parseDSVNoQuotes:()=>l});var s=i(1258);var r=i(52191);var n;(function(e){e[e["QUOTED_FIELD"]=0]="QUOTED_FIELD";e[e["QUOTED_FIELD_QUOTE"]=1]="QUOTED_FIELD_QUOTE";e[e["UNQUOTED_FIELD"]=2]="UNQUOTED_FIELD";e[e["NEW_FIELD"]=3]="NEW_FIELD";e[e["NEW_ROW"]=4]="NEW_ROW"})(n||(n={}));var o;(function(e){e[e["CR"]=0]="CR";e[e["CRLF"]=1]="CRLF";e[e["LF"]=2]="LF"})(o||(o={}));function a(e){const{data:t,columnOffsets:i,delimiter:s=",",startIndex:r=0,maxRows:a=4294967295,rowDelimiter:l="\r\n",quote:h='"'}=e;let d=e.ncols;let c=0;const u=[];const _=s.charCodeAt(0);const f=h.charCodeAt(0);const w=10;const m=13;const g=t.length;const{QUOTED_FIELD:p,QUOTED_FIELD_QUOTE:C,UNQUOTED_FIELD:y,NEW_FIELD:O,NEW_ROW:D}=n;const{CR:b,LF:x,CRLF:v}=o;const[R,E]=l==="\r\n"?[v,2]:l==="\r"?[b,1]:[x,1];let S=D;let k=r;let P=0;let q;while(k<g){if(S===D){u.push(k);P=1}q=t.charCodeAt(k);switch(S){case D:case O:switch(q){case f:S=p;break;case _:S=O;break;case m:if(R===b){S=D}else if(R===v&&t.charCodeAt(k+1)===w){k++;S=D}else{throw`string index ${k} (in row ${c}, column ${P}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case w:if(R===x){S=D}else{throw`string index ${k} (in row ${c}, column ${P}): line feed found, but row delimiter starts with a carriage return`}break;default:S=y;break}break;case p:k=t.indexOf(h,k);if(k<0){throw`string index ${k} (in row ${c}, column ${P}): mismatched quote`}S=C;break;case C:switch(q){case f:S=p;break;case _:S=O;break;case m:if(R===b){S=D}else if(R===v&&t.charCodeAt(k+1)===w){k++;S=D}else{throw`string index ${k} (in row ${c}, column ${P}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case w:if(R===x){S=D}else{throw`string index ${k} (in row ${c}, column ${P}): line feed found, but row delimiter starts with a carriage return`}break;default:throw`string index ${k} (in row ${c}, column ${P}): quote in escaped field not followed by quote, delimiter, or row delimiter`}break;case y:while(k<g){q=t.charCodeAt(k);if(q===_||q===w||q===m){break}k++}switch(q){case _:S=O;break;case m:if(R===b){S=D}else if(R===v&&t.charCodeAt(k+1)===w){k++;S=D}else{throw`string index ${k} (in row ${c}, column ${P}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case w:if(R===x){S=D}else{throw`string index ${k} (in row ${c}, column ${P}): line feed found, but row delimiter starts with a carriage return`}break;default:continue}break;default:throw`string index ${k} (in row ${c}, column ${P}): state not recognized`}k++;switch(S){case D:c++;if(d===undefined){if(c!==1){throw new Error("Error parsing default number of columns")}d=P}if(i===true){if(P<d){for(;P<d;P++){u.push(k-E)}}else if(P>d){u.length=u.length-(P-d)}}if(c===a){return{nrows:c,ncols:i?d:0,offsets:u}}break;case O:if(i===true){u.push(k)}P++;break;default:break}}if(S!==D){c++;if(i===true){if(d===undefined){d=P}if(P<d){for(;P<d;P++){u.push(k-(E-1))}}else if(P>d){u.length=u.length-(P-d)}}}return{nrows:c,ncols:i?d!==null&&d!==void 0?d:0:0,offsets:u}}function l(e){const{data:t,columnOffsets:i,delimiter:s=",",rowDelimiter:r="\r\n",startIndex:n=0,maxRows:o=4294967295}=e;let a=e.ncols;const l=[];let h=0;const d=r.length;let c=n;const u=t.length;let _;let f;let w;let m;let g;_=n;while(_!==-1&&h<o&&c<u){l.push(c);h++;_=t.indexOf(r,c);g=_===-1?u:_;if(i===true){f=1;w=t.slice(c,g);m=w.indexOf(s);if(a===undefined){while(m!==-1){l.push(c+m+1);f++;m=w.indexOf(s,m+1)}a=f}else{while(m!==-1&&f<a){l.push(c+m+1);f++;m=w.indexOf(s,m+1)}while(f<a){l.push(g);f++}}}c=g+d}return{nrows:h,ncols:i?a!==null&&a!==void 0?a:0:0,offsets:l}}const h={quotes:a,noquotes:l};class d extends s.DataModel{constructor(e){super();this._rowCount=1;this._header=[];this._columnOffsets=new Uint32Array(0);this._columnOffsetsStartingRow=0;this._maxCacheGet=1e3;this._rowOffsets=new Uint32Array(1);this._delayedParse=null;this._startedParsing=false;this._doneParsing=false;this._isDisposed=false;this._ready=new r.PromiseDelegate;let{data:t,delimiter:i=",",rowDelimiter:s=undefined,quote:n='"',quoteParser:o=undefined,header:a=true,initialRows:l=500}=e;this._rawData=t;this._delimiter=i;this._quote=n;this._quoteEscaped=new RegExp(n+n,"g");this._initialRows=l;if(s===undefined){const e=t.slice(0,5e3).indexOf("\r");if(e===-1){s="\n"}else if(t[e+1]==="\n"){s="\r\n"}else{s="\r"}}this._rowDelimiter=s;if(o===undefined){o=t.indexOf(n)>=0}this._parser=o?"quotes":"noquotes";this.parseAsync();if(a===true&&this._columnCount>0){const e=[];for(let t=0;t<this._columnCount;t++){e.push(this._getField(0,t))}this._header=e}}get isDisposed(){return this._isDisposed}get ready(){return this._ready.promise}get rawData(){return this._rawData}set rawData(e){this._rawData=e}get initialRows(){return this._initialRows}set initialRows(e){this._initialRows=e}get header(){return this._header}set header(e){this._header=e}get delimiter(){return this._delimiter}get rowDelimiter(){return this._rowDelimiter}get doneParsing(){return this._doneParsing}rowCount(e){if(e==="body"){if(this._header.length===0){return this._rowCount}else{return this._rowCount-1}}return 1}columnCount(e){if(e==="body"){return this._columnCount}return 1}data(e,t,i){let s;switch(e){case"body":if(this._header.length===0){s=this._getField(t,i)}else{s=this._getField(t+1,i)}break;case"column-header":if(this._header.length===0){s=(i+1).toString()}else{s=this._header[i]}break;case"row-header":s=(t+1).toString();break;case"corner-header":s="";break;default:throw"unreachable"}return s}dispose(){if(this._isDisposed){return}this._isDisposed=true;this._columnCount=undefined;this._rowCount=undefined;this._rowOffsets=null;this._columnOffsets=null;this._rawData=null;if(this._doneParsing===false){this.ready.catch((()=>{}));this._ready.reject(undefined)}if(this._delayedParse!==null){window.clearTimeout(this._delayedParse)}}getOffsetIndex(e,t){const i=this._columnCount;let s=(e-this._columnOffsetsStartingRow)*i;if(s<0||s>this._columnOffsets.length){this._columnOffsets.fill(4294967295);this._columnOffsetsStartingRow=e;s=0}if(this._columnOffsets[s]===4294967295){let t=1;while(t<=this._maxCacheGet&&this._columnOffsets[s+t*i]===16777215){t++}const{offsets:r}=h[this._parser]({data:this._rawData,delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:true,maxRows:t,ncols:i,startIndex:this._rowOffsets[e]});for(let e=0;e<r.length;e++){this._columnOffsets[s+e]=r[e]}}return this._columnOffsets[s+t]}parseAsync(){let e=this._initialRows;let t=Math.pow(2,32)-1;const i=30;const s=e=>{try{this._computeRowOffsets(e)}catch(t){if(this._parser==="quotes"){console.warn(t);this._parser="noquotes";this._resetParser();this._computeRowOffsets(e)}else{throw t}}return this._doneParsing};this._resetParser();const r=s(e);if(r){return}const n=()=>{const r=s(e+t);e+=t;if(t<1e6){t*=2}if(r){this._delayedParse=null}else{this._delayedParse=window.setTimeout(n,i)}};this._delayedParse=window.setTimeout(n,i)}_computeRowOffsets(e=4294967295){if(this._rowCount>=e||this._doneParsing===true){return}if(this._columnCount===undefined){this._columnCount=h[this._parser]({data:this._rawData,delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:true,maxRows:1}).ncols}const{nrows:t,offsets:i}=h[this._parser]({data:this._rawData,startIndex:this._rowOffsets[this._rowCount-1],delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:false,maxRows:e-this._rowCount+1});if(this._startedParsing&&t<=1){this._doneParsing=true;this._ready.resolve(undefined);return}this._startedParsing=true;const s=this._rowCount;this._rowCount=s+t-1;if(this._rowCount<e){this._doneParsing=true;this._ready.resolve(undefined)}const r=this._rowOffsets;this._rowOffsets=new Uint32Array(this._rowCount);this._rowOffsets.set(r);this._rowOffsets.set(i,s-1);const n=Math.floor(33554432/this._columnCount);if(s<=n){if(this._rowCount<=n){const e=this._columnOffsets;this._columnOffsets=new Uint32Array(this._rowCount*this._columnCount);this._columnOffsets.set(e);this._columnOffsets.fill(4294967295,e.length)}else{const e=this._columnOffsets;this._columnOffsets=new Uint32Array(Math.min(this._maxCacheGet,n)*this._columnCount);this._columnOffsets.set(e.subarray(0,this._columnOffsets.length));this._columnOffsets.fill(4294967295,e.length);this._columnOffsetsStartingRow=0}}let o=s;if(this._header.length>0){o-=1}this.emitChanged({type:"rows-inserted",region:"body",index:o,span:this._rowCount-s})}_getField(e,t){let i;let s;const r=this.getOffsetIndex(e,t);let n=0;let o=0;if(t===this._columnCount-1){if(e<this._rowCount-1){s=this.getOffsetIndex(e+1,0);n+=this._rowDelimiter.length}else{s=this._rawData.length;if(this._rawData[s-1]===this._rowDelimiter[this._rowDelimiter.length-1]){n+=this._rowDelimiter.length}}}else{s=this.getOffsetIndex(e,t+1);if(r<s&&this._rawData[s-1]===this._delimiter){n+=1}}if(this._rawData[r]===this._quote){o+=1;n+=1}i=this._rawData.slice(r+o,s-n);if(o===1&&i.indexOf(this._quote)!==-1){i=i.replace(this._quoteEscaped,this._quote)}return i}_resetParser(){this._columnCount=undefined;this._rowOffsets=new Uint32Array(1);this._rowCount=1;this._startedParsing=false;this._columnOffsets=new Uint32Array(0);if(this._doneParsing===false){this.ready.catch((()=>{}));this._ready.reject(undefined)}this._doneParsing=false;this._ready=new r.PromiseDelegate;if(this._delayedParse!==null){window.clearTimeout(this._delayedParse);this._delayedParse=null}this.emitChanged({type:"model-reset"})}}var c=i(93269);var u=i(63117);var _=i(86992);var f=i(90265);var w=i(21157);const m="jp-CSVDelimiter";const g="jp-CSVDelimiter-label";const p="jp-CSVDelimiter-dropdown";class C extends _.Widget{constructor(e){super({node:y.createNode(e.selected,e.translator)});this._delimiterChanged=new u.Signal(this);this.addClass(m)}get delimiterChanged(){return this._delimiterChanged}get selectNode(){return this.node.getElementsByTagName("select")[0]}handleEvent(e){switch(e.type){case"change":this._delimiterChanged.emit(this.selectNode.value);break;default:break}}onAfterAttach(e){this.selectNode.addEventListener("change",this)}onBeforeDetach(e){this.selectNode.removeEventListener("change",this)}}var y;(function(e){function t(e,t){t=t||w.nullTranslator;const i=t===null||t===void 0?void 0:t.load("jupyterlab");const s=[[",",","],[";",";"],["\t",i.__("tab")],["|",i.__("pipe")],["#",i.__("hash")]];const r=document.createElement("div");const n=document.createElement("span");const o=document.createElement("select");n.textContent=i.__("Delimiter: ");n.className=g;(0,c.each)(s,(([t,i])=>{const s=document.createElement("option");s.value=t;s.textContent=i;if(t===e){s.selected=true}o.appendChild(s)}));r.appendChild(n);const a=f.Styling.wrapSelect(o);a.classList.add(p);r.appendChild(a);return r}e.createNode=t})(y||(y={}));var O=i(66995);var D=i(18834);var b=undefined&&undefined.__rest||function(e,t){var i={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0)i[s]=e[s];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++){if(t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r]))i[s[r]]=e[s[r]]}return i};const x="jp-CSVViewer";const v="jp-CSVViewer-grid";const R=1e3;class E{}class S{constructor(e){this._looping=true;this._changed=new u.Signal(this);this._grid=e;this._query=null;this._row=0;this._column=-1}get changed(){return this._changed}cellBackgroundColorRendererFunc(e){return({value:t,row:i,column:s})=>{if(this._query){if(t.match(this._query)){if(this._row===i&&this._column===s){return e.currentMatchBackgroundColor}return e.matchBackgroundColor}}return""}}clear(){this._query=null;this._row=0;this._column=-1;this._changed.emit(undefined)}find(e,t=false){const i=this._grid.dataModel;const s=i.rowCount("body");const r=i.columnCount("body");if(this._query!==e){this._row=0;this._column=-1}this._query=e;const n=this._grid.scrollY/this._grid.defaultSizes.rowHeight;const o=(this._grid.scrollY+this._grid.pageHeight)/this._grid.defaultSizes.rowHeight;const a=this._grid.scrollX/this._grid.defaultSizes.columnHeaderHeight;const l=(this._grid.scrollX+this._grid.pageWidth)/this._grid.defaultSizes.columnHeaderHeight;const h=(e,t)=>e>=n&&e<=o&&t>=a&&t<=l;const d=t?-1:1;this._column+=d;for(let c=this._row;t?c>=0:c<s;c+=d){for(let s=this._column;t?s>=0:s<r;s+=d){const t=i.data("body",c,s);if(t.match(e)){this._changed.emit(undefined);if(!h(c,s)){this._grid.scrollToRow(c)}this._row=c;this._column=s;return true}}this._column=t?r-1:0}if(this._looping){this._looping=false;this._row=t?0:s-1;this._wrapRows(t);try{return this.find(e,t)}finally{this._looping=true}}return false}_wrapRows(e=false){const t=this._grid.dataModel;const i=t.rowCount("body");const s=t.columnCount("body");if(e&&this._row<=0){this._row=i-1;this._column=s}else if(!e&&this._row>=i-1){this._row=0;this._column=-1}}get query(){return this._query}}class k extends _.Widget{constructor(e){super();this._monitor=null;this._delimiter=",";this._revealed=new r.PromiseDelegate;this._baseRenderer=null;const t=this._context=e.context;const i=this.layout=new _.PanelLayout;this.addClass(x);this._grid=new s.DataGrid({defaultSizes:{rowHeight:24,columnWidth:144,rowHeaderWidth:64,columnHeaderHeight:36}});this._grid.addClass(v);this._grid.headerVisibility="all";this._grid.keyHandler=new s.BasicKeyHandler;this._grid.mouseHandler=new s.BasicMouseHandler;this._grid.copyConfig={separator:"\t",format:s.DataGrid.copyFormatGeneric,headers:"all",warningThreshold:1e6};i.addWidget(this._grid);this._searchService=new S(this._grid);this._searchService.changed.connect(this._updateRenderer,this);void this._context.ready.then((()=>{this._updateGrid();this._revealed.resolve(undefined);this._monitor=new O.ActivityMonitor({signal:t.model.contentChanged,timeout:R});this._monitor.activityStopped.connect(this._updateGrid,this)}))}get context(){return this._context}get revealed(){return this._revealed.promise}get delimiter(){return this._delimiter}set delimiter(e){if(e===this._delimiter){return}this._delimiter=e;this._updateGrid()}get style(){return this._grid.style}set style(e){this._grid.style=e}set rendererConfig(e){this._baseRenderer=e;this._updateRenderer()}get searchService(){return this._searchService}dispose(){if(this._monitor){this._monitor.dispose()}super.dispose()}goToLine(e){this._grid.scrollToRow(e)}onActivateRequest(e){this.node.tabIndex=-1;this.node.focus()}_updateGrid(){const e=this._context.model.toString();const t=this._delimiter;const i=this._grid.dataModel;const r=this._grid.dataModel=new d({data:e,delimiter:t});this._grid.selectionModel=new s.BasicSelectionModel({dataModel:r});if(i){i.dispose()}}_updateRenderer(){if(this._baseRenderer===null){return}const e=this._baseRenderer;const t=new s.TextRenderer({textColor:e.textColor,horizontalAlignment:e.horizontalAlignment,backgroundColor:this._searchService.cellBackgroundColorRendererFunc(e)});this._grid.cellRenderers.update({body:t,"column-header":t,"corner-header":t,"row-header":t})}}class P extends D.DocumentWidget{constructor(e){let{content:t,context:i,delimiter:s,reveal:r}=e,n=b(e,["content","context","delimiter","reveal"]);t=t||q.createContent(i);r=Promise.all([r,t.revealed]);super(Object.assign({content:t,context:i,reveal:r},n));if(s){t.delimiter=s}const o=new C({selected:t.delimiter});this.toolbar.addItem("delimiter",o);o.delimiterChanged.connect(((e,i)=>{t.delimiter=i}))}setFragment(e){const t=e.split("=");if(t[0]!=="#row"){return}let i=t[1].split(";")[0];i=i.split("-")[0];void this.context.ready.then((()=>{this.content.goToLine(Number(i))}))}}var q;(function(e){function t(e){return new k({context:e})}e.createContent=t})(q||(q={}));class F extends D.ABCWidgetFactory{createNewWidget(e){const t=this.translator;return new P({context:e,translator:t})}}class $ extends D.ABCWidgetFactory{createNewWidget(e){const t="\t";return new P({context:e,delimiter:t,translator:this.translator})}}}}]);