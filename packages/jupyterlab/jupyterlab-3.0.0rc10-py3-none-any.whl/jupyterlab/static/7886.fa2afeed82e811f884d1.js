(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[7886],{97886:(t,e,s)=>{"use strict";s.r(e);s.d(e,{AttachmentsCell:()=>kt,AttachmentsCellModel:()=>B,Cell:()=>jt,CellDragUtils:()=>c,CellFooter:()=>j,CellHeader:()=>O,CellModel:()=>U,CodeCell:()=>bt,CodeCellModel:()=>z,Collapser:()=>C,InputArea:()=>A,InputCollapser:()=>y,InputPlaceholder:()=>st,InputPrompt:()=>H,MarkdownCell:()=>Dt,MarkdownCellModel:()=>$,OutputCollapser:()=>v,OutputPlaceholder:()=>nt,Placeholder:()=>et,RawCell:()=>Ft,RawCellModel:()=>J,isCodeCellModel:()=>V,isMarkdownCellModel:()=>L,isRawCellModel:()=>T});var n=s(93269);var a=s(74858);const o=5;const r="jp-dragImage";const i="jp-dragImage-singlePrompt";const d="jp-dragImage-content";const l="jp-dragImage-prompt";const u="jp-dragImage-multipleBack";var c;(function(t){function e(t,e,s){let a=-1;while(t&&t.parentElement){if(s(t)){(0,n.each)(e,((e,s)=>{if(e.node===t){a=s;return false}}));break}t=t.parentElement}return a}t.findCell=e;function s(t,e){let s;if(t){if(t.editorWidget.node.contains(e)){s="input"}else if(t.promptNode.contains(e)){s="prompt"}else{s="cell"}}else{s="unknown"}return s}t.detectTargetArea=s;function c(t,e,s,n){const a=Math.abs(s-t);const r=Math.abs(n-e);return a>=o||r>=o}t.shouldStartDrag=c;function h(t,e){const s=e.length;let n;if(t.model.type==="code"){const e=t.model.executionCount;n=" ";if(e){n=e.toString()}}else{n=""}const o=t.model.value.text.split("\n")[0].slice(0,26);if(s>1){if(n!==""){return a.VirtualDOM.realize(a.h.div(a.h.div({className:r},a.h.span({className:l},"["+n+"]:"),a.h.span({className:d},o)),a.h.div({className:u},"")))}else{return a.VirtualDOM.realize(a.h.div(a.h.div({className:r},a.h.span({className:l}),a.h.span({className:d},o)),a.h.div({className:u},"")))}}else{if(n!==""){return a.VirtualDOM.realize(a.h.div(a.h.div({className:`${r} ${i}`},a.h.span({className:l},"["+n+"]:"),a.h.span({className:d},o))))}else{return a.VirtualDOM.realize(a.h.div(a.h.div({className:`${r} ${i}`},a.h.span({className:l}),a.h.span({className:d},o))))}}}t.createCellDragImage=h})(c||(c={}));var h=s(90265);var p=s(77865);const m="jp-Collapser";const f="jp-Collapser-child";const g="jp-InputCollapser";const _="jp-OutputCollapser";class C extends h.ReactWidget{constructor(){super();this.addClass(m)}get collapsed(){return false}render(){const t=f;return p.createElement("div",{className:t,onClick:t=>this.handleClick(t)})}}class y extends C{constructor(){super();this.addClass(g)}get collapsed(){var t;const e=(t=this.parent)===null||t===void 0?void 0:t.parent;if(e){return e.inputHidden}else{return false}}handleClick(t){var e;const s=(e=this.parent)===null||e===void 0?void 0:e.parent;if(s){s.inputHidden=!s.inputHidden}this.update()}}class v extends C{constructor(){super();this.addClass(_)}get collapsed(){var t;const e=(t=this.parent)===null||t===void 0?void 0:t.parent;if(e){return e.outputHidden}else{return false}}handleClick(t){var e;const s=(e=this.parent)===null||e===void 0?void 0:e.parent;if(s){s.outputHidden=!s.outputHidden}this.update()}}var w=s(86992);const S="jp-CellHeader";const x="jp-CellFooter";class O extends w.Widget{constructor(){super();this.addClass(S)}}class j extends w.Widget{constructor(){super();this.addClass(x)}}var b=s(53703);var k=s(53799);const D="jp-InputArea";const F="jp-InputArea-prompt";const E="jp-InputPrompt";const P="jp-InputArea-editor";class A extends w.Widget{constructor(t){super();this.addClass(D);const e=this.model=t.model;const s=this.contentFactory=t.contentFactory||A.defaultContentFactory;const n=this._prompt=s.createInputPrompt();n.addClass(F);const a={model:e,factory:s.editorFactory,updateOnShow:t.updateOnShow};const o=this._editor=new b.CodeEditorWrapper(a);o.addClass(P);const r=this.layout=new w.PanelLayout;r.addWidget(n);r.addWidget(o)}get editorWidget(){return this._editor}get editor(){return this._editor.editor}get promptNode(){return this._prompt.node}renderInput(t){const e=this.layout;if(this._rendered){this._rendered.parent=null}this._editor.hide();this._rendered=t;e.addWidget(t)}showEditor(){if(this._rendered){this._rendered.parent=null}this._editor.show()}setPrompt(t){this._prompt.executionCount=t}dispose(){if(this.isDisposed){return}this._prompt=null;this._editor=null;this._rendered=null;super.dispose()}}(function(t){class e{constructor(e={}){this._editor=e.editorFactory||t.defaultEditorFactory}get editorFactory(){return this._editor}createInputPrompt(){return new H}}t.ContentFactory=e;function s(){const t=new k.CodeMirrorEditorFactory;return t.newInlineEditor}t.defaultEditorFactory=s();t.defaultContentFactory=new e({})})(A||(A={}));class H extends w.Widget{constructor(){super();this._executionCount=null;this.addClass(E)}get executionCount(){return this._executionCount}set executionCount(t){this._executionCount=t;if(t===null){this.node.textContent=" "}else{this.node.textContent=`[${t||" "}]:`}}}var W=s(52191);var I=s(63117);var M=s(40219);var N=s(50961);var R=undefined&&undefined.__rest||function(t,e){var s={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0)s[n]=t[n];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++){if(e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a]))s[n[a]]=t[n[a]]}return s};function V(t){return t.type==="code"}function L(t){return t.type==="markdown"}function T(t){return t.type==="raw"}class U extends b.CodeEditor.Model{constructor(t){super({modelDB:t.modelDB});this.contentChanged=new I.Signal(this);this.stateChanged=new I.Signal(this);this.id=t.id||W.UUID.uuid4();this.value.changed.connect(this.onGenericChange,this);const e=this.modelDB.createValue("type");e.set(this.type);const s=this.modelDB.createMap("metadata");s.changed.connect(this.onGenericChange,this);const n=t.cell;const a=this.modelDB.createValue("trusted");a.changed.connect(this.onTrustedChanged,this);if(!n){a.set(false);return}a.set(!!n.metadata["trusted"]);delete n.metadata["trusted"];if(Array.isArray(n.source)){this.value.text=n.source.join("")}else{this.value.text=n.source}const o=W.JSONExt.deepCopy(n.metadata);if(this.type!=="raw"){delete o["format"]}if(this.type!=="code"){delete o["collapsed"];delete o["scrolled"]}for(const r in o){s.set(r,o[r])}}get type(){return"raw"}get metadata(){return this.modelDB.get("metadata")}get trusted(){return this.modelDB.getValue("trusted")}set trusted(t){const e=this.trusted;if(e===t){return}this.modelDB.setValue("trusted",t)}toJSON(){const t=Object.create(null);for(const e of this.metadata.keys()){const s=JSON.parse(JSON.stringify(this.metadata.get(e)));t[e]=s}if(this.trusted){t["trusted"]=true}return{cell_type:this.type,source:this.value.text,metadata:t}}onTrustedChanged(t,e){}onGenericChange(){this.contentChanged.emit(void 0)}}class B extends U{constructor(t){super(t);const e=t.contentFactory||B.defaultContentFactory;let s;const n=t.cell;if(n&&(n.cell_type==="raw"||n.cell_type==="markdown")){s=n.attachments}this._attachments=e.createAttachmentsModel({values:s,modelDB:this.modelDB});this._attachments.stateChanged.connect(this.onGenericChange,this)}get attachments(){return this._attachments}toJSON(){const t=super.toJSON();if(this.attachments.length){t.attachments=this.attachments.toJSON()}return t}}(function(t){class e{createAttachmentsModel(t){return new M.AttachmentsModel(t)}}t.ContentFactory=e;t.defaultContentFactory=new e})(B||(B={}));class J extends B{get type(){return"raw"}toJSON(){return super.toJSON()}}class $ extends B{constructor(t){super(t);this.mimeType="text/x-ipythongfm"}get type(){return"markdown"}toJSON(){return super.toJSON()}}class z extends U{constructor(t){super(t);const e=t.contentFactory||z.defaultContentFactory;const s=this.trusted;const n=t.cell;let a=[];const o=this.modelDB.createValue("executionCount");if(!o.get()){if(n&&n.cell_type==="code"){o.set(n.execution_count||null);a=n.outputs}else{o.set(null)}}o.changed.connect(this._onExecutionCountChanged,this);this._outputs=e.createOutputArea({trusted:s,values:a});this._outputs.changed.connect(this.onGenericChange,this);this.metadata.changed.connect(q.collapseChanged,this);if(this.metadata.has("collapsed")){const t=this.metadata.get("collapsed");q.collapseChanged(this.metadata,{type:"change",key:"collapsed",oldValue:t,newValue:t})}else if(this.metadata.has("jupyter")){const t=this.metadata.get("jupyter");if(t.hasOwnProperty("outputs_hidden")){q.collapseChanged(this.metadata,{type:"change",key:"jupyter",oldValue:t,newValue:t})}}}get type(){return"code"}get executionCount(){return this.modelDB.getValue("executionCount")}set executionCount(t){const e=this.executionCount;if(t===e){return}this.modelDB.setValue("executionCount",t||null)}clearExecution(){this.outputs.clear();this.executionCount=null;this.metadata.delete("execution")}get outputs(){return this._outputs}dispose(){if(this.isDisposed){return}this._outputs.dispose();this._outputs=null;super.dispose()}toJSON(){const t=super.toJSON();t.execution_count=this.executionCount||null;t.outputs=this.outputs.toJSON();return t}onTrustedChanged(t,e){if(this._outputs){this._outputs.trusted=e.newValue}this.stateChanged.emit({name:"trusted",oldValue:e.oldValue,newValue:e.newValue})}_onExecutionCountChanged(t,e){this.contentChanged.emit(void 0);this.stateChanged.emit({name:"executionCount",oldValue:e.oldValue,newValue:e.newValue})}}(function(t){class e{createOutputArea(t){return new N.OutputAreaModel(t)}}t.ContentFactory=e;t.defaultContentFactory=new e})(z||(z={}));var q;(function(t){function e(t,e){if(e.key==="collapsed"){const s=t.get("jupyter")||{};const{outputs_hidden:n}=s,a=R(s,["outputs_hidden"]);if(n!==e.newValue){if(e.newValue!==undefined){a["outputs_hidden"]=e.newValue}if(Object.keys(a).length===0){t.delete("jupyter")}else{t.set("jupyter",a)}}}else if(e.key==="jupyter"){const s=e.newValue||{};if(s.hasOwnProperty("outputs_hidden")){t.set("collapsed",s.outputs_hidden)}else{t.delete("collapsed")}}}t.collapseChanged=e})(q||(q={}));var G=s(29103);const X="jp-Placeholder";const K="jp-Placeholder-prompt jp-InputPrompt";const Q="jp-Placeholder-prompt jp-OutputPrompt";const Y="jp-Placeholder-content";const Z="jp-InputPlaceholder";const tt="jp-OutputPlaceholder";class et extends h.ReactWidget{constructor(t){super();this.addClass(X);this._callback=t}handleClick(t){const e=this._callback;e(t)}}class st extends et{constructor(t){super(t);this.addClass(Z)}render(){return[p.createElement("div",{className:K,key:"input"}),p.createElement("div",{className:Y,onClick:t=>this.handleClick(t),key:"content"},p.createElement(G.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}class nt extends et{constructor(t){super(t);this.addClass(tt)}render(){return[p.createElement("div",{className:Q,key:"output"}),p.createElement("div",{className:Y,onClick:t=>this.handleClick(t),key:"content"},p.createElement(G.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}var at=s(66995);var ot=s(21644);const rt="jp-Cell";const it="jp-Cell-header";const dt="jp-Cell-footer";const lt="jp-Cell-inputWrapper";const ut="jp-Cell-outputWrapper";const ct="jp-Cell-inputArea";const ht="jp-Cell-outputArea";const pt="jp-Cell-inputCollapser";const mt="jp-Cell-outputCollapser";const ft="jp-mod-readOnly";const gt="jp-CodeCell";const _t="jp-MarkdownCell";const Ct="jp-MarkdownOutput";const yt="jp-RawCell";const vt="jp-mod-rendered";const wt="jp-mod-noOutputs";const St="Type Markdown and LaTeX: $ Î±^2 $";const xt=1e3;const Ot="application/x-jupyter-icontentsrich";class jt extends w.Widget{constructor(t){super();this._readOnly=false;this._inputHidden=false;this._syncCollapse=false;this._syncEditable=false;this.addClass(rt);const e=this._model=t.model;const s=this.contentFactory=t.contentFactory||jt.defaultContentFactory;this.layout=new w.PanelLayout;const n=s.createCellHeader();n.addClass(it);this.layout.addWidget(n);const a=this._inputWrapper=new w.Panel;a.addClass(lt);const o=new y;o.addClass(pt);const r=this._input=new A({model:e,contentFactory:s,updateOnShow:t.updateEditorOnShow});r.addClass(ct);a.addWidget(o);a.addWidget(r);this.layout.addWidget(a);this._inputPlaceholder=new st((()=>{this.inputHidden=!this.inputHidden}));const i=this.contentFactory.createCellFooter();i.addClass(dt);this.layout.addWidget(i);if(t.editorConfig){Object.keys(t.editorConfig).forEach((e=>{var s,n;this.editor.setOption(e,(n=(s=t.editorConfig)===null||s===void 0?void 0:s[e])!==null&&n!==void 0?n:null)}))}e.metadata.changed.connect(this.onMetadataChanged,this)}initializeState(){this.loadCollapseState();this.loadEditableState();return this}get promptNode(){if(!this._inputHidden){return this._input.promptNode}else{return this._inputPlaceholder.node.firstElementChild}}get editorWidget(){return this._input.editorWidget}get editor(){return this._input.editor}get model(){return this._model}get inputArea(){return this._input}get readOnly(){return this._readOnly}set readOnly(t){if(t===this._readOnly){return}this._readOnly=t;if(this.syncEditable){this.saveEditableState()}this.update()}saveEditableState(){const{metadata:t}=this.model;const e=t.get("editable");if(this.readOnly&&e===false||!this.readOnly&&e===undefined){return}if(this.readOnly){this.model.metadata.set("editable",false)}else{this.model.metadata.delete("editable")}}loadEditableState(){this.readOnly=this.model.metadata.get("editable")===false}get ready(){return Promise.resolve(undefined)}setPrompt(t){this._input.setPrompt(t)}get inputHidden(){return this._inputHidden}set inputHidden(t){if(this._inputHidden===t){return}const e=this._inputWrapper.layout;if(t){this._input.parent=null;e.addWidget(this._inputPlaceholder)}else{this._inputPlaceholder.parent=null;e.addWidget(this._input)}this._inputHidden=t;if(this.syncCollapse){this.saveCollapseState()}this.handleInputHidden(t)}saveCollapseState(){const t=Object.assign({},this.model.metadata.get("jupyter"));if(this.inputHidden&&t.source_hidden===true||!this.inputHidden&&t.source_hidden===undefined){return}if(this.inputHidden){t.source_hidden=true}else{delete t.source_hidden}if(Object.keys(t).length===0){this.model.metadata.delete("jupyter")}else{this.model.metadata.set("jupyter",t)}}loadCollapseState(){const t=this.model.metadata.get("jupyter")||{};this.inputHidden=!!t.source_hidden}handleInputHidden(t){return}get syncCollapse(){return this._syncCollapse}set syncCollapse(t){if(this._syncCollapse===t){return}this._syncCollapse=t;if(t){this.loadCollapseState()}}get syncEditable(){return this._syncEditable}set syncEditable(t){if(this._syncEditable===t){return}this._syncEditable=t;if(t){this.loadEditableState()}}clone(){const t=this.constructor;return new t({model:this.model,contentFactory:this.contentFactory})}dispose(){if(this.isDisposed){return}this._input=null;this._model=null;this._inputWrapper=null;this._inputPlaceholder=null;super.dispose()}onAfterAttach(t){this.update()}onActivateRequest(t){this.editor.focus()}onFitRequest(t){this.editor.refresh()}onUpdateRequest(t){if(!this._model){return}if(this.editor.getOption("readOnly")!==this._readOnly){this.editor.setOption("readOnly",this._readOnly);this.toggleClass(ft,this._readOnly)}}onMetadataChanged(t,e){switch(e.key){case"jupyter":if(this.syncCollapse){this.loadCollapseState()}break;case"editable":if(this.syncEditable){this.loadEditableState()}break;default:break}}}(function(t){class e{constructor(t={}){this._editorFactory=t.editorFactory||A.defaultEditorFactory}get editorFactory(){return this._editorFactory}createCellHeader(){return new O}createCellFooter(){return new j}createInputPrompt(){return new H}createOutputPrompt(){return new N.OutputPrompt}createStdin(t){return new N.Stdin(t)}}t.ContentFactory=e;t.defaultContentFactory=new e})(jt||(jt={}));class bt extends jt{constructor(t){super(t);this._outputHidden=false;this._syncScrolled=false;this._savingMetadata=false;this.addClass(gt);const e=this._rendermime=t.rendermime;const s=this.contentFactory;const n=this.model;const a=this._outputWrapper=new w.Panel;a.addClass(ut);const o=new v;o.addClass(mt);const r=this._output=new N.OutputArea({model:n.outputs,rendermime:e,contentFactory:s});r.addClass(ht);if(n.outputs.length===0){this.addClass(wt)}r.outputLengthChanged.connect(this._outputLengthHandler,this);a.addWidget(o);a.addWidget(r);this.layout.insertWidget(2,a);this._outputPlaceholder=new nt((()=>{this.outputHidden=!this.outputHidden}));n.stateChanged.connect(this.onStateChanged,this)}initializeState(){super.initializeState();this.loadScrolledState();this.setPrompt(`${this.model.executionCount||""}`);return this}get outputArea(){return this._output}get outputHidden(){return this._outputHidden}set outputHidden(t){if(this._outputHidden===t){return}const e=this._outputWrapper.layout;if(t){e.removeWidget(this._output);e.addWidget(this._outputPlaceholder);if(this.inputHidden&&!this._outputWrapper.isHidden){this._outputWrapper.hide()}}else{if(this._outputWrapper.isHidden){this._outputWrapper.show()}e.removeWidget(this._outputPlaceholder);e.addWidget(this._output)}this._outputHidden=t;if(this.syncCollapse){this.saveCollapseState()}}saveCollapseState(){this._savingMetadata=true;try{super.saveCollapseState();const t=this.model.metadata;const e=this.model.metadata.get("collapsed");if(this.outputHidden&&e===true||!this.outputHidden&&e===undefined){return}if(this.outputHidden){t.set("collapsed",true)}else{t.delete("collapsed")}}finally{this._savingMetadata=false}}loadCollapseState(){super.loadCollapseState();this.outputHidden=!!this.model.metadata.get("collapsed")}get outputsScrolled(){return this._outputsScrolled}set outputsScrolled(t){this.toggleClass("jp-mod-outputsScrolled",t);this._outputsScrolled=t;if(this.syncScrolled){this.saveScrolledState()}}saveScrolledState(){const{metadata:t}=this.model;const e=t.get("scrolled");if(this.outputsScrolled&&e===true||!this.outputsScrolled&&e===undefined){return}if(this.outputsScrolled){t.set("scrolled",true)}else{t.delete("scrolled")}}loadScrolledState(){const t=this.model.metadata;if(t.get("scrolled")==="auto"){this.outputsScrolled=false}else{this.outputsScrolled=!!t.get("scrolled")}}get syncScrolled(){return this._syncScrolled}set syncScrolled(t){if(this._syncScrolled===t){return}this._syncScrolled=t;if(t){this.loadScrolledState()}}handleInputHidden(t){if(!t&&this._outputWrapper.isHidden){this._outputWrapper.show()}else if(t&&!this._outputWrapper.isHidden&&this._outputHidden){this._outputWrapper.hide()}}clone(){const t=this.constructor;return new t({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime})}cloneOutputArea(){return new N.SimplifiedOutputArea({model:this.model.outputs,contentFactory:this.contentFactory,rendermime:this._rendermime})}dispose(){if(this.isDisposed){return}this._output.outputLengthChanged.disconnect(this._outputLengthHandler,this);this._rendermime=null;this._output=null;this._outputWrapper=null;this._outputPlaceholder=null;super.dispose()}onStateChanged(t,e){switch(e.name){case"executionCount":this.setPrompt(`${t.executionCount||""}`);break;default:break}}onMetadataChanged(t,e){if(this._savingMetadata){return}switch(e.key){case"scrolled":if(this.syncScrolled){this.loadScrolledState()}break;case"collapsed":if(this.syncCollapse){this.loadCollapseState()}break;default:break}super.onMetadataChanged(t,e)}_outputLengthHandler(t,e){const s=e===0?true:false;this.toggleClass(wt,s)}}(function(t){async function e(t,e,s){var n;const a=t.model;const o=a.value.text;if(!o.trim()||!((n=e.session)===null||n===void 0?void 0:n.kernel)){a.clearExecution();return}const r={cellId:a.id};s=Object.assign(Object.assign(Object.assign({},a.metadata.toJSON()),s),r);const{recordTiming:i}=s;a.clearExecution();t.outputHidden=false;t.setPrompt("*");a.trusted=true;let d;try{const n=N.OutputArea.execute(o,t.outputArea,e,s);if(i){const e=t=>{let e;switch(t.header.msg_type){case"status":e=`status.${t.content.execution_state}`;break;case"execute_input":e="execute_input";break;default:return true}const s=t.header.date||(new Date).toISOString();const n=Object.assign({},a.metadata.get("execution"));n[`iopub.${e}`]=s;a.metadata.set("execution",n);return true};t.outputArea.future.registerMessageHook(e)}else{a.metadata.delete("execution")}d=t.outputArea.future;const r=await n;a.executionCount=r.content.execution_count;if(i){const t=Object.assign({},a.metadata.get("execution"));const e=r.metadata.started;if(e){t["shell.execute_reply.started"]=e}const s=r.header.date;t["shell.execute_reply"]=s||(new Date).toISOString();a.metadata.set("execution",t)}return r}catch(l){if(d&&!t.isDisposed&&t.outputArea.future===d){t.setPrompt("")}throw l}}t.execute=e})(bt||(bt={}));class kt extends jt{handleEvent(t){switch(t.type){case"paste":this._evtPaste(t);break;case"dragenter":t.preventDefault();break;case"dragover":t.preventDefault();break;case"drop":this._evtNativeDrop(t);break;case"lm-dragover":this._evtDragOver(t);break;case"lm-drop":this._evtDrop(t);break;default:break}}onAfterAttach(t){super.onAfterAttach(t);const e=this.node;e.addEventListener("lm-dragover",this);e.addEventListener("lm-drop",this);e.addEventListener("dragenter",this);e.addEventListener("dragover",this);e.addEventListener("drop",this);e.addEventListener("paste",this)}onBeforeDetach(t){const e=this.node;e.removeEventListener("drop",this);e.removeEventListener("dragover",this);e.removeEventListener("dragenter",this);e.removeEventListener("paste",this);e.removeEventListener("lm-dragover",this);e.removeEventListener("lm-drop",this)}_evtDragOver(t){const e=(0,n.some)(ot.imageRendererFactory.mimeTypes,(e=>{if(!t.mimeData.hasData(Ot)){return false}const s=t.mimeData.getData(Ot);return s.model.mimetype===e}));if(!e){return}t.preventDefault();t.stopPropagation();t.dropAction=t.proposedAction}_evtPaste(t){if(t.clipboardData){const e=t.clipboardData.items;for(let s=0;s<e.length;s++){if(e[s].type==="text/plain"){if(s<e.length-1&&e[s+1].kind==="file"){continue}e[s].getAsString((t=>{var e,s;(s=(e=this.editor).replaceSelection)===null||s===void 0?void 0:s.call(e,t)}))}this._attachFiles(t.clipboardData.items)}}t.preventDefault()}_evtNativeDrop(t){if(t.dataTransfer){this._attachFiles(t.dataTransfer.items)}t.preventDefault()}_evtDrop(t){const e=(0,n.toArray)((0,n.filter)(t.mimeData.types(),(e=>{if(e===Ot){const e=t.mimeData.getData(Ot);return ot.imageRendererFactory.mimeTypes.indexOf(e.model.mimetype)!==-1}return ot.imageRendererFactory.mimeTypes.indexOf(e)!==-1})));if(e.length===0){return}t.preventDefault();t.stopPropagation();if(t.proposedAction==="none"){t.dropAction="none";return}t.dropAction="copy";for(const s of e){if(s===Ot){const{model:e,withContent:s}=t.mimeData.getData(Ot);if(e.type==="file"){const t=this._generateURI(e.name);this.updateCellSourceWithAttachment(e.name,t);void s().then((e=>{this.model.attachments.set(t,{[e.mimetype]:e.content})}))}}else{const e=this._generateURI();this.model.attachments.set(e,{[s]:t.mimeData.getData(s)});this.updateCellSourceWithAttachment(e,e)}}}_attachFiles(t){for(let e=0;e<t.length;e++){const s=t[e];if(s.kind==="file"){const t=s.getAsFile();if(t){this._attachFile(t)}}}}_attachFile(t){const e=new FileReader;e.onload=s=>{const{href:n,protocol:a}=at.URLExt.parse(e.result);if(a!=="data:"){return}const o=/([\w+\/\+]+)?(?:;(charset=[\w\d-]*|base64))?,(.*)/;const r=o.exec(n);if(!r||r.length!==4){return}const i=r[1];const d=r[3];const l={[i]:d};const u=this._generateURI(t.name);if(i.startsWith("image/")){this.model.attachments.set(u,l);this.updateCellSourceWithAttachment(t.name,u)}};e.onerror=e=>{console.error(`Failed to attach ${t.name}`+e)};e.readAsDataURL(t)}_generateURI(t=""){const e=t.lastIndexOf(".");return e!==-1?W.UUID.uuid4().concat(t.substring(e)):W.UUID.uuid4()}}class Dt extends kt{constructor(t){var e;super(t);this._renderer=null;this._rendered=true;this._prevText="";this._ready=new W.PromiseDelegate;this.addClass(_t);this._rendermime=t.rendermime.clone({resolver:new M.AttachmentsResolver({parent:(e=t.rendermime.resolver)!==null&&e!==void 0?e:undefined,model:this.model.attachments})});this.editor.setOption("handlePaste",false);this._monitor=new at.ActivityMonitor({signal:this.model.contentChanged,timeout:xt});this._monitor.activityStopped.connect((()=>{if(this._rendered){this.update()}}),this);void this._updateRenderedInput().then((()=>{this._ready.resolve(void 0)}));this.renderInput(this._renderer)}get ready(){return this._ready.promise}get rendered(){return this._rendered}set rendered(t){if(t===this._rendered){return}this._rendered=t;this._handleRendered();if(!this._rendered){this.editor.refresh()}}renderInput(t){this.addClass(vt);this.inputArea.renderInput(t)}showEditor(){this.removeClass(vt);this.inputArea.showEditor()}onUpdateRequest(t){this._handleRendered();super.onUpdateRequest(t)}updateCellSourceWithAttachment(t,e){var s,n;const a=`![${t}](attachment:${e!==null&&e!==void 0?e:t})`;(n=(s=this.editor).replaceSelection)===null||n===void 0?void 0:n.call(s,a)}_handleRendered(){if(!this._rendered){this.showEditor()}else{void this._updateRenderedInput();this.renderInput(this._renderer)}}_updateRenderedInput(){const t=this.model;const e=t&&t.value.text||St;if(e!==this._prevText){const t=new ot.MimeModel({data:{"text/markdown":e}});if(!this._renderer){this._renderer=this._rendermime.createRenderer("text/markdown");this._renderer.addClass(Ct)}this._prevText=e;return this._renderer.renderModel(t)}return Promise.resolve(void 0)}clone(){const t=this.constructor;return new t({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime})}}class Ft extends jt{constructor(t){super(t);this.addClass(yt)}clone(){const t=this.constructor;return new t({model:this.model,contentFactory:this.contentFactory})}}}}]);