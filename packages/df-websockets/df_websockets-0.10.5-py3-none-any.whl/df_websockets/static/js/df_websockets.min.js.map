{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./df_websockets/app.js","webpack:///./df_websockets/base.js","webpack:///./df_websockets/forms.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","window","DFSignals","connection","buffer","registry","wsurl","document","addEventListener","websocketConnect","dfWsURL","cname","ca","decodeURIComponent","cookie","split","length","charAt","substring","indexOf","getCookie","WebSocket","onopen","send","onmessage","e","console","debug","data","msg","JSON","parse","signal","signal_id","opts","onerror","error","onclose","setTimeout","id","undefined","stringify","push","connect","fn","querySelectorAll","selector","forEach","elt","classList","add","class_name","insertAdjacentElement","content","append","firstChild","removeChild","insertBefore","parent","parentNode","removeAttribute","attr_name","remove","outerHTML","setAttribute","attr_value","innerHTML","textContent","save","createElement","href","url","target","download","filename","evt","MouseEvent","view","bubbles","cancelable","dispatchEvent","URL","webkitURL","revokeObjectURL","querySelector","focus","serializeForm","form","serialized","elements","field","disabled","type","files","selectedOptions","checked","getAttribute","eventName","on","tagName","prevent","preventDefault","DOMContentAdded"],"mappings":"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","file":"df_websockets/static/js/df_websockets.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","////////////////////////////////////////////////////////////////////////////////\n// This file is part of df_websockets                                          /\n//                                                                             /\n// Copyright (C) 2020 Matthieu Gallet <github@19pouces.net>                    /\n// All Rights Reserved                                                         /\n//                                                                             /\n// You may use, distribute and modify this code under the                      /\n// terms of the (BSD-like) CeCILL-B license.                                   /\n//                                                                             /\n// You should have received a copy of the CeCILL-B license with                /\n// this file. If not, please visit:                                            /\n// https://cecill.info/licences/Licence_CeCILL-B_V1-en.txt (English)           /\n// or https://cecill.info/licences/Licence_CeCILL-B_V1-fr.txt (French)         /\n//                                                                             /\n////////////////////////////////////////////////////////////////////////////////\n\nwindow.DFSignals = {\n    connection: null,\n    buffer: [],\n    registry: {},\n    wsurl: null\n};\n\nfunction getCookie(cname) {\n    const name = cname + \"=\";\n    const decodedCookie = decodeURIComponent(document.cookie);\n    const ca = decodedCookie.split(';');\n    for (let i = 0; i < ca.length; i++) {\n        let c = ca[i];\n        while (c.charAt(0) === ' ') {\n            c = c.substring(1);\n        }\n        if (c.indexOf(name) === 0) {\n            return c.substring(name.length, c.length);\n        }\n    }\n    return \"\";\n}\n\nfunction websocketConnect() {\n    if (window.DFSignals.wsurl === null) {\n        const dfWsURL = getCookie(\"dfwsurl\");\n        window.DFSignals.wsurl = decodeURIComponent(dfWsURL);\n    }\n    if (!window.DFSignals.wsurl) {\n        return;\n    }\n    const connection = new WebSocket(window.DFSignals.wsurl);\n    /* cannot use header or cookies (cookies may change after the initial connection)\n    *  so we use GET parameter\n    *  */\n    connection.onopen = () => {\n        window.DFSignals.connection = connection;\n        for (let i = 0; i < window.DFSignals.buffer.length; i++) {\n            connection.send(window.DFSignals.buffer[i]);\n        }\n        window.DFSignals.buffer = [];\n    };\n    connection.onmessage = (e) => {\n        console.debug('received call ' + e.data + ' from server.')\n        const msg = JSON.parse(e.data);\n        // noinspection JSUnresolvedVariable\n        if (msg.signal && msg.signal_id) {\n            window.DFSignals.call(msg.signal, msg.opts, msg.signal_id);\n        }\n    };\n    connection.onerror = (e) => {\n        console.error(\"WS error: \" + e);\n    };\n    connection.onclose = () => {\n        window.DFSignals.connection = null;\n        setTimeout(websocketConnect, 3000);\n    }\n}\n\nfunction call(signal, opts, id) {\n    /*\"\"\"\n    .. function:: call(signal, opts, id)\n\n        Call a signal.\n        If the signal is also defined in the Python server and available to the user, then the Python signal is also triggered.\n\n        :param string signal: Name of the called signal.\n        :param object opts: Object with signal arguments.\n        :param string id: Unique id of each signal triggered by the server. Do not use it yourself.\n        :returns: always `false`.\n    */\n    // if (window.DFSignals.registry[signal] === undefined) {\n    //     console.debug('unknown call \"' + signal + '\" (from both client and server).');\n    //     return false;\n    // } else\n    if ((id !== undefined) && (window.DFSignals.registry[id] !== undefined)) {\n        return false;\n    } else if (id !== undefined) {\n        window.DFSignals.registry[id] = true;\n    }\n    if (window.DFSignals.registry[signal] !== undefined) {\n        console.debug('call \"' + signal + '\"', opts);\n        for (let i = 0; i < window.DFSignals.registry[signal].length; i += 1) {\n            window.DFSignals.registry[signal][i](opts, id);\n        }\n    }\n    if (id === undefined) {\n        console.debug('call from client: \"' + signal + '\"', opts);\n        const msg = JSON.stringify({signal: signal, opts: opts});\n        if (window.DFSignals.connection) {\n            window.DFSignals.connection.send(msg);\n        } else {\n            window.DFSignals.buffer.push(msg);\n        }\n    }\n\n    return false;\n}\n\nfunction connect(signal, fn) {\n    /*\"\"\"\n    .. function:: connect(signal, fn)\n\n        Connect a javascript code to the given signal name.\n\n        :param string signal: Name of the signal.\n        :param function fn: Function that takes a single object as argument. The properties of this object are the signal arguments.\n        :returns: nothing.\n    */\n    if (window.DFSignals.registry[signal] === undefined) {\n        window.DFSignals.registry[signal] = [];\n    }\n    window.DFSignals.registry[signal].push(fn);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", websocketConnect);\n\nwindow.DFSignals.call = call;\nwindow.DFSignals.connect = connect;\n","////////////////////////////////////////////////////////////////////////////////\n// This file is part of df_websockets                                          /\n//                                                                             /\n// Copyright (C) 2020 Matthieu Gallet <github@19pouces.net>                    /\n// All Rights Reserved                                                         /\n//                                                                             /\n// You may use, distribute and modify this code under the                      /\n// terms of the (BSD-like) CeCILL-B license.                                   /\n//                                                                             /\n// You should have received a copy of the CeCILL-B license with                /\n// this file. If not, please visit:                                            /\n// https://cecill.info/licences/Licence_CeCILL-B_V1-en.txt (English)           /\n// or https://cecill.info/licences/Licence_CeCILL-B_V1-fr.txt (French)         /\n//                                                                             /\n////////////////////////////////////////////////////////////////////////////////\n\nfunction connectSignals() {\n\n    // noinspection ES6ModulesDependencies\n    window.DFSignals.connect('html.add_class', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.classList.add(opts.class_name)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.add_class(opts)\n\n        Adds the specified class(es) to each of the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.add_class', {selector: \"#obj\", class_name: \"myclass\"});\n\n        :param string selector: jQuery selector\n        :param string class_name: new class\n\n    */\n\n    window.DFSignals.connect('html.after', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertAdjacentElement('afterend', opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.after(opts)\n\n        Insert content, specified by the parameter, after each element in the set of matched elements..\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.after', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.append', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.append(opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.append(opts)\n\n        Insert content, specified by the parameter, to the end of each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.append', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.before', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertAdjacentElement('beforebegin', opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.before(opts)\n\n        Insert content, specified by the parameter, before each element in the set of matched elements..\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.before', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.empty', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            while (elt.firstChild) {\n                elt.removeChild(elt.firstChild);\n            }\n        });\n    });\n    /*\"\"\"\n    .. function:: html.empty(opts)\n\n        Remove all child nodes of the set of matched elements from the DOM.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.empty', {selector: \"#obj\"});\n\n        :param string selector: jQuery selector\n\n    */\n\n    window.DFSignals.connect('html.prepend', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertBefore(opts.content, parent.firstChild);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.prepend(opts)\n\n        Insert content, specified by the parameter, to the beginning of each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.prepend', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.remove', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.parentNode.removeChild(elt)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove(opts)\n\n        Remove the set of matched elements from the DOM.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove', {selector: \"#obj\"});\n\n        :param string selector: jQuery selector\n\n    */\n    window.DFSignals.connect('html.remove_attr', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.removeAttribute(opts.attr_name);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove_attr(opts)\n\n        Remove an attribute from each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove_attr', {selector: \"#obj\", attr_name: \"attr\"});\n\n        :param string selector: jQuery selector\n        :param string attr_name: attribute to remove\n\n    */\n    window.DFSignals.connect('html.remove_class', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.classList.remove(opts.class_name);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove_class(opts)\n\n        Remove a single class, multiple classes, or all classes from each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove_class', {selector: \"#obj\", class_name: \"class\"});\n\n        :param string selector: jQuery selector\n        :param string class_name: class to remove\n\n    */\n    window.DFSignals.connect('html.replace_with', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.outerHTML = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.replace_with(opts)\n\n        Replace each element in the set of matched elements with the provided new content.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.replace_with', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.add_attribute', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.setAttribute(opts.attr_name, opts.attr_value);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.after(opts)\n\n        Insert content, specified by the parameter, after each element in the set of matched elements..\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.after', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.content', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.innerHTML = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.content(opts)\n\n        set the HTML contents of every matched element.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.content', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n    */\n\n\n    window.DFSignals.connect('html.text', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.textContent = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.text(opts)\n\n        Set the text contents of the matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.text', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n\n        :param string selector: jQuery selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.download_file', (opts) => {\n        /*\"\"\"\n        .. function:: html.download_file(opts)\n\n            Force the client to download the given file.\n\n            .. code-block:: javascript\n\n                window.DFSignals.call('html.download_file', {url: \"http://example.org/test.zip\", filename: \"test.zip\"});\n\n\n            :param string url: URL of the file\n            :param string filename: name of the file\n\n        */\n        const save = document.createElement('a');\n        save.href = opts.url;\n        save.target = '_blank';\n        save.download = opts.filename || 'unknown';\n        const evt = new MouseEvent('click', {view: window, bubbles: true, cancelable: false});\n        save.dispatchEvent(evt);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n    });\n\n\n    window.DFSignals.connect('html.focus', (opts) => {\n        const elt = document.querySelector(opts.selector);\n        if (elt) {\n            elt.focus();\n        }\n    });\n    /*\"\"\"\n    .. function:: html.focus(opts)\n\n        Set the focus to the matched element.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.focus', {selector: \"#obj\"});\n\n        :param string selector: jQuery selector\n\n    */\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", connectSignals);\n","////////////////////////////////////////////////////////////////////////////////\n// This file is part of df_websockets                                          /\n//                                                                             /\n// Copyright (C) 2020 Matthieu Gallet <github@19pouces.net>                    /\n// All Rights Reserved                                                         /\n//                                                                             /\n// You may use, distribute and modify this code under the                      /\n// terms of the (BSD-like) CeCILL-B license.                                   /\n//                                                                             /\n// You should have received a copy of the CeCILL-B license with                /\n// this file. If not, please visit:                                            /\n// https://cecill.info/licences/Licence_CeCILL-B_V1-en.txt (English)           /\n// or https://cecill.info/licences/Licence_CeCILL-B_V1-fr.txt (French)         /\n//                                                                             /\n////////////////////////////////////////////////////////////////////////////////\n\nexport function serializeForm(form) {\n    const serialized = [];\n    // Loop through each field in the form\n    for (let i = 0; i < form.elements.length; i++) {\n        const field = form.elements[i];\n        // Respect the same rules as jQuery's serializeArray\n        if (!field.name || field.disabled || field.type === 'reset' || field.type === 'submit' || field.type === 'button') {\n            continue;\n        }\n        if (field.type === \"file\") {  // just returns the name of selected files\n            for (let n = 0; n < field.files.length; n++) {\n                serialized.push({name: field.name, value: field.files[n].name});\n            }\n        } else if (field.type === 'select-multiple') { // get all selected options\n            for (let n = 0; n < field.selectedOptions.length; n++) {\n                serialized.push({name: field.name, value: field.selectedOptions[n].value});\n            }\n        } else if ((field.type !== 'checkbox' && field.type !== 'radio') || field.checked) {\n            serialized.push({name: field.name, value: field.value});\n        }\n    }\n    return serialized;\n}\n\n\nfunction DOMContentAdded(evt) {\n    /*\n    looks for an attribute \"data-df-signal\" that contains a JSON-list of objects:\n    {\n        name: \"name of the signal to call\",  (required)\n        on: \"name of the listened event\",    (optional: defaults to \"submit\" for forms, \"\" )\n        opts: \"extra options\",               (optional)\n        form: \"name of option to add to opts that contains the serialized form\",  (optional)\n        value: \"name of option to add to opts that contains the value\",  (optional)\n        prevent: preventDefault               (optional, defaults to true for on==\"change\" else false )\n    }\n     */\n    evt.target.querySelectorAll(\"[data-df-signal]\").forEach(\n        target => {\n            const signals = JSON.parse(target.getAttribute(\"data-df-signal\"));\n            signals.forEach(signal => {\n                let eventName = signal.on;\n                if (!eventName) {\n                    if (target.tagName === \"FORM\") {\n                        eventName = \"submit\";\n                    } else if ((target.tagName === \"INPUT\" && !(target.type === 'reset' || target.type === 'submit' || target.type === 'button')) || (target.tagName === \"TEXTAREA\")) {\n                        eventName = \"change\";\n                    } else {\n                        eventName = \"click\";\n                    }\n                }\n                const callback = evt => {\n                    // noinspection JSUnresolvedVariable\n                    const prevent = signal.prevent;\n                    const opts = signal.opts || {};\n                    if (signal.form) {\n                        opts[signal.form] = serializeForm(target);\n                    }\n                    if (signal.value) {\n\n                        if (target.type === \"file\") {  // just returns the name of selected files\n                            opts[signal.value] = [];\n                            for (let n = 0; n < target.files.length; n++) {\n                                opts[signal.value].push(target.files[n].name);\n                            }\n                        } else if (target.type === 'select-multiple') { // get all selected options\n                            opts[signal.value] = [];\n                            for (let n = 0; n < target.selectedOptions.length; n++) {\n                                opts[signal.value].push(target.selectedOptions[n].value);\n                            }\n                        } else if (target.type === 'checkbox' || target.type === 'radio') {\n                            opts[signal.value] = target.checked;\n\n                        } else {\n                            opts[signal.value] = target.value;\n                        }\n                    }\n                    window.DFSignals.call(\n                        signal.name,\n                        opts\n                    );\n\n                    if (prevent === true || (prevent === null && eventName !== \"change\")) {\n                        evt.preventDefault();\n                    }\n                }\n                target.addEventListener(eventName, callback);\n            });\n        }\n    );\n}\n\n\ndocument.addEventListener(\"DOMContentAdded\", (evt) => {\n    window.setTimeout(() => {\n        DOMContentAdded(evt);\n    }, 200);\n    // awful trick for being sure that our addEventListener is the last.\n    // allows things like CKEditor to push its content to the textarea before sending the content of the form.\n});"],"sourceRoot":""}