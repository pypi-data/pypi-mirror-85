(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[91],{2166:function(e,t,r){"use strict";var n=r(24),i=r.n(n).a.createActions(["fetch","showAllSimilarItems","toggleUnmerge","toggleMerge","unmerge","merge","toggleCollapseFingerprint","toggleCollapseFingerprints"]);t.a=i},2167:function(e,t,r){"use strict";var n=r(28),i=r.n(n),a=r(6),s=r.n(a),o=r(33),c=r.n(o),l=r(24),u=r.n(l),g=r(287),d=r.n(g),p=r(54),m=r(34),f=r(2166);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){s()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={listenables:[f.a],api:new p.a,init:function(){var e=this,t=this.getInitialState();Object.entries(t).forEach((function(t){var r=c()(t,2),n=r[0],i=r[1];e[n]=i}))},getInitialState:function(){return{mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:[],mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}},setStateForId:function(e,t,r){return(Array.isArray(t)?t:[t]).map((function(t){var n=b(b({},e.has(t)&&e.get(t)||{}),r);return e.set(t,n),n}))},isAllUnmergedSelected:function(){var e=Array.from(this.unmergeState.values()).filter((function(e){return e.busy}))||[];return this.unmergeList.size===this.mergedItems.filter((function(e){return!!e.latestEvent})).length-e.length},convertScoreStructure:function(e,t){if(e.hasOwnProperty("exception:stacktrace:application-chunks")&&delete e["exception:stacktrace:application-chunks"],!t||"1"===t)return e;var r={},n=Object.keys(e);for(var i in n){var a=n[i];a.includes("message:character-5-shingle")?r["message:message:character-shingles"]=e[a]:a.includes("value:character-5-shingle")?r["exception:message:character-shingles"]=e[a]:a.includes("stacktrace:frames-pairs")&&(r["exception:stacktrace:pairs"]=e[a])}return r},onFetch:function(e){var t,r=this,n=e||this.toFetchArray,i=null==e?void 0:null===(t=e[0])||void 0===t?void 0:t.version;this.init(),this.triggerFetchState();var a=n.map((function(e){var t=e.endpoint,n=e.queryParams,i=e.dataKey;return new Promise((function(e,a){r.api.request(t,{method:"GET",data:n,success:function(t,r,n){e({dataKey:i,data:t,links:n?n.getResponseHeader("Link"):null})},error:function(e){var t,r=(null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||!0;a(r)}})}))})),s={merged:function(e){return r.setStateForId(r.unmergeState,e.id,{busy:"locked"===e.state}),e},similar:function(e){var t=c()(e,2),n=t[0],a=t[1],s=r.convertScoreStructure(a,i),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e);return!t.map((function(t){return e[t]})).find((function(e){return e>=.6}))}(s),l=Object.keys(s).map((function(e){return[e,s[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1],a=String(n).split(":"),s=c()(a,1)[0];return e[s]||(e[s]=[]),e[s].push([n,i]),e}),{}),u=Object.keys(l).map((function(e){return[e,l[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1].filter((function(e){return null!==c()(e,2)[1]})),a=i.reduce((function(e,t){return e+c()(t,2)[1]}),0)/i.length;return e[n]=a,e}),{});return{issue:n,score:s,scoresByInterface:l,aggregate:u,isBelowThreshold:o}}};return e&&(this.toFetchArray=e),Promise.all(a).then((function(e){e.forEach((function(e){var t=e.dataKey,n=e.data,i=e.links,a=n.map(s[t]);r["".concat(t,"Items")]=a,r["".concat(t,"Links")]=i})),r.loading=!1,r.error=!1,r.triggerFetchState()}),(function(){r.loading=!1,r.error=!0,r.triggerFetchState()}))},onToggleMerge:function(e){var t=!1,r=this.mergeState.has(e)?this.mergeState.get(e):void 0;!0!==(null==r?void 0:r.busy)&&(this.mergeList.includes(e)?this.mergeList=this.mergeList.filter((function(t){return t!==e})):(this.mergeList=[].concat(i()(this.mergeList),[e]),t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge:function(e){var t=c()(e,2),r=t[0],n=t[1],i=!1,a=this.unmergeState.get(r);!0!==(null==a?void 0:a.busy)&&(this.unmergeList.has(r)?this.unmergeList.delete(r):(this.unmergeList.set(r,n),i=!0),this.setStateForId(this.unmergeState,r,{checked:i}),this.unmergeDisabled=0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge:function(e){var t=this,r=e.groupId,n=e.loadingMessage,i=e.successMessage,a=e.errorMessage,s=Array.from(this.unmergeList.keys());return new Promise((function(e,o){t.isAllUnmergedSelected()?o(new Error("Not allowed to unmerge ALL events")):(t.unmergeDisabled=!0,t.setStateForId(t.unmergeState,s,{checked:!1,busy:!0}),t.triggerUnmergeState(),Object(m.b)(n),t.api.request("/issues/".concat(r,"/hashes/"),{method:"DELETE",query:{id:s},success:function(){Object(m.d)(i),t.setStateForId(t.unmergeState,s,{checked:!1,busy:!0}),t.unmergeList.clear()},error:function(){Object(m.a)(a),t.setStateForId(t.unmergeState,s,{checked:!0,busy:!1})},complete:function(){t.unmergeDisabled=!1,e(t.triggerUnmergeState())}}))}))},onMerge:function(e){var t=this,r=e.params,n=e.query,a=e.projectId;if(r){var s=this.mergeList;return this.mergeDisabled=!0,this.setStateForId(this.mergeState,s,{busy:!0}),this.triggerMergeState(),new Promise((function(e){var o=r.orgId,c=r.groupId;t.api.merge({orgId:o,projectId:a||r.projectId,itemIds:[].concat(i()(s),[c]),query:n},{success:function(e){var r;(null==e?void 0:null===(r=e.merge)||void 0===r?void 0:r.parent)&&t.trigger({mergedParent:e.merge.parent}),t.setStateForId(t.mergeState,s,{checked:!1,busy:!0}),t.mergeList=[]},error:function(){t.setStateForId(t.mergeState,s,{checked:!0,busy:!1})},complete:function(){t.mergeDisabled=!1,e(t.triggerMergeState())}})}))}},onToggleCollapseFingerprints:function(){this.setStateForId(this.unmergeState,this.mergedItems.map((function(e){return e.id})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint:function(e){var t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState:function(){var e=b({similarItems:this.similarItems.filter((function(e){return!e.isBelowThreshold})),filteredSimilarItems:this.similarItems.filter((function(e){return e.isBelowThreshold}))},d()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error"]));return this.trigger(e),e},triggerUnmergeState:function(){var e=d()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState:function(){var e=d()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e}};t.a=u.a.createStore(v)},2255:function(e,t,r){"use strict";var n=r(3),i=r(2),a=r.n(i),s=Object(n.a)("div",{target:"e1uibv5p0",label:"FlowLayout"})("display:flex;flex:1;align-items:center;flex-direction:",(function(e){return e.vertical?"column":null}),";justify-content:",(function(e){return e.center?"center":null}),";overflow:",(function(e){return e.truncate?"hidden":null}),";");s.propTypes={center:a.a.bool,vertical:a.a.bool,truncate:a.a.bool},s.defaultProps={truncate:!0},t.a=s},2256:function(e,t,r){"use strict";var n=r(7),i=r.n(n),a=r(16),s=r.n(a),o=(r(1),r(42)),c=r.n(o),l=r(0),u=function(e){var t=e.responsive,r=void 0!==t&&t,n=e.center,a=void 0===n||n,o=e.children,u=e.className,g=s()(e,["responsive","center","children","className"]),d=c()("spread-layout",u,{center:a,"allow-responsive":r});return Object(l.f)("div",i()({},g,{className:d}),o)};u.displayName="SpreadLayout",t.a=u},2336:function(e,t,r){"use strict";var n=r(3),i=Object(n.a)("div",{target:"e1pdx9kr0",label:"Toolbar"})("background:",(function(e){return e.theme.backgroundSecondary}),";border:1px solid ",(function(e){return e.theme.border}),";border-bottom:none;border-radius:3px 3px 0 0;box-shadow:0 1px 0 ",(function(e){return e.theme.border}),";margin:0;");t.a=i},2983:function(e,t,r){"use strict";r.r(t),r.d(t,"GroupMergedView",(function(){return pe}));var n=r(6),i=r.n(n),a=r(1),s=r.n(a),o=r(24),c=r.n(o),l=r(35),u=r.n(l),g=r(81),d=r(4),p=r(73),m=r(2166),f=r(2167),h=r(122),b=r(44),v=r(9),y=r.n(v),j=r(10),O=r.n(j),S=r(12),I=r.n(S),L=r(13),k=r.n(L),w=r(5),C=r.n(w),F=r(3),x=r(165),D=r(314),P=r(706),E=r(353),M=r(15),T=r(322),U=r(769),q=r(2255),A=r(8),N=r(0),z=u()({displayName:"MergedItem",mixins:[c.a.listenTo(f.a,"onGroupingChange")],getInitialState:function(){return{collapsed:!1,checked:!1,busy:!1}},onGroupingChange:function(e){var t=this,r=e.unmergeState;if(r){var n=this.props.fingerprint,a=r.has(n)&&r.get(n);a&&Object.keys(a).forEach((function(e){a[e]!==t.state[e]&&t.setState(i()({},e,a[e]))}))}},handleToggleEvents:function(){var e=this.props.fingerprint;m.a.toggleCollapseFingerprint(e)},handleLabelClick:function(e){e.preventDefault()},handleToggle:function(){var e=this.props,t=e.disabled,r=e.fingerprint,n=e.event;t||this.state.busy||m.a.toggleUnmerge([r,n.id])},handleCheckClick:function(){},render:function(){var e=this.props,t=e.disabled,r=e.event,n=e.fingerprint,i=t||this.state.disabled;return Object(N.f)(G,{busy:this.state.busy},Object(N.f)(R,{expanded:!this.state.collapsed},Object(N.f)(q.a,{onClick:this.handleToggle},Object(N.f)(B,null,Object(N.f)(T.a,{id:n,value:n,checked:this.state.checked,disabled:i,onChange:this.handleCheckClick})),Object(N.f)(K,{onClick:this.handleLabelClick,htmlFor:n},n)),Object(N.f)("div",null,Object(N.f)("span",null),Object(N.f)(W,{onClick:this.handleToggleEvents},this.state.collapsed?Object(N.f)(M.j,{direction:"down",size:"xs"}):Object(N.f)(M.j,{direction:"up",size:"xs"})))),!this.state.collapsed&&Object(N.f)(J,{className:"event-list"},r&&Object(N.f)(V,{className:"event-details"},Object(N.f)(q.a,null,Object(N.f)(U.a,{data:r,hideIcons:!0,hideLevel:!0})))))}}),G=Object(F.a)("div",{target:"e9r3vga0",label:"MergedGroup"})((function(e){return e.busy&&"opacity: 0.2"}),";"),B=Object(F.a)("div",{target:"e9r3vga1",label:"ActionColumn"})({name:"1rergdr",styles:"display:flex;padding:0 10px;align-items:center;input{margin:0;}"}),R=Object(F.a)("div",{target:"e9r3vga2",label:"Controls"})("display:flex;justify-content:space-between;border-top:1px solid ",(function(e){return e.theme.innerBorder}),";background-color:#f3f1f6;padding:",Object(A.a)(.5)," 0;",(function(e){return e.expanded&&"border-bottom: 1px solid ".concat(e.theme.innerBorder)}),";",G,"{&:first-child &{border-top:none;}&:last-child &{border-top:none;border-bottom:1px solid ",(function(e){return e.theme.innerBorder}),";}}"),K=Object(F.a)("label",{target:"e9r3vga3",label:"Fingerprint"})("font-family:",(function(e){return e.theme.text.familyMono}),";",R," &{font-weight:normal;margin:0;}"),W=Object(F.a)("span",{target:"e9r3vga4",label:"Collapse"})({name:"1myftmo",styles:"cursor:pointer;padding:0 10px;"}),J=Object(F.a)("div",{target:"e9r3vga5",label:"MergedEventList"})({name:"1qzh383",styles:"overflow:hidden;border:none;"}),V=Object(F.a)("div",{target:"e9r3vga6",label:"EventDetails"})({name:"fk2u57",styles:"display:flex;justify-content:space-between;.event-list &{padding:10px;}"}),H=z,Q=r(33),X=r.n(Q),Y=r(287),Z=r.n(Y),$=r(102),_=r(31),ee=r(736),te=r(2256),re=r(2336),ne=u()({displayName:"MergedToolbar",mixins:[c.a.listenTo(f.a,"onGroupingUpdate")],getInitialState:function(){var e=f.a.unmergeList,t=f.a.unmergeLastCollapsed,r=f.a.unmergeDisabled;return{enableFingerprintCompare:f.a.enableFingerprintCompare,unmergeList:e,unmergeLastCollapsed:t,unmergeDisabled:r}},onGroupingUpdate:function(e){this.setState(Z()(e,["unmergeLastCollapsed","unmergeDisabled","unmergeList","enableFingerprintCompare"]))},handleShowDiff:function(e){var t=this.props,r=t.groupId,n=t.project,i=t.orgId,a=this.state.unmergeList.entries();if(2===this.state.unmergeList.size){var s=Array.from(a).map((function(e){return X()(e,2)[1]})),o=X()(s,2),c=o[0],l=o[1];Object($.f)({baseIssueId:r,targetIssueId:r,baseEventId:c,targetEventId:l,orgId:i,project:n}),e.stopPropagation()}},render:function(){var e=this.props,t=e.onUnmerge,r=e.onToggleCollapse,n=this.state.unmergeList&&this.state.unmergeList.size||0;return Object(N.f)(ae,null,Object(N.f)(te.a,null,Object(N.f)(te.a,null,Object(N.f)("div",null,Object(N.f)(ee.a,{disabled:this.state.unmergeDisabled,title:Object(d.b)("Unmerging ".concat(n," events")),message:Object(d.b)("These events will be unmerged and grouped into a new issue. Are you sure you want to unmerge these events?"),className:"btn btn-sm btn-default",onConfirm:t},Object(d.b)("Unmerge")," (",n||0,")"),Object(N.f)(ie,{size:"small",disabled:!this.state.enableFingerprintCompare,onClick:this.handleShowDiff},Object(d.b)("Compare")))),Object(N.f)(te.a,null,Object(N.f)("div",null,Object(N.f)(_.a,{size:"small",onClick:r},this.state.unmergeLastCollapsed?Object(d.b)("Expand All"):Object(d.b)("Collapse All"))))))}}),ie=Object(F.a)(_.a,{target:"e1seayw30",label:"CompareButton"})("margin-left:",Object(A.a)(1),";"),ae=Object(F.a)(re.a,{target:"e1seayw31",label:"StyledToolbar"})("padding:",Object(A.a)(.5)," ",Object(A.a)(1),";"),se=ne;function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=C()(e);if(t){var i=C()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return k()(this,r)}}var ce=function(e){I()(r,e);var t=oe(r);function r(){var e;y()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).renderEmpty=function(){return Object(N.f)(D.a,null,Object(N.f)("p",null,Object(d.b)("There don't seem to be any hashes for this issue.")))},e}return O()(r,[{key:"render",value:function(){var e=this.props,t=e.items,r=e.pageLinks,n=e.onToggleCollapse,i=e.onUnmerge,a=e.orgId,s=e.project,o=t.filter((function(e){return!!e.latestEvent}));return o.length>0?Object(N.f)("div",null,Object(N.f)("h2",null,Object(N.f)("span",null,Object(d.b)("Merged fingerprints with latest event")),Object(N.f)(E.a,{count:o.length})),Object(N.f)(se,{onToggleCollapse:n,onUnmerge:i,orgId:a,project:s}),Object(N.f)(ue,null,o.map((function(e){var r=e.id,n=e.latestEvent;return Object(N.f)(H,{key:r,orgId:a,projectId:s.slug,disabled:1===t.length,event:n,fingerprint:r})}))),Object(N.f)(P.a,{pageLinks:r})):Object(N.f)(x.a,null,this.renderEmpty())}}]),r}(s.a.Component);ce.displayName="MergedList";var le=ce,ue=Object(F.a)("div",{target:"e16p6prb0",label:"MergedItems"})("border:1px solid ",(function(e){return e.theme.border}),";border-top:none;");function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var pe=u()({displayName:"GroupMergedView",mixins:[c.a.listenTo(f.a,"onGroupingUpdate")],getInitialState:function(){return{mergedItems:[],loading:!0,error:!1,query:this.props.location.query.query||""}},componentWillMount:function(){this.fetchData()},componentWillReceiveProps:function(e){if(e.params.groupId!==this.props.params.groupId||e.location.search!==this.props.location.search){var t=e.location.query;this.setState({query:t.query},this.fetchData)}},onGroupingUpdate:function(e){var t=e.mergedItems,r=e.mergedLinks,n=e.loading,i=e.error;t&&this.setState({mergedItems:t,mergedLinks:r,loading:void 0!==n&&n,error:void 0!==i&&i})},getEndpoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hashes",t=this.props.params,r=de(de({},this.props.location.query),{},{limit:50,query:this.state.query});return"/issues/".concat(t.groupId,"/").concat(e,"/?").concat(g.stringify(r))},fetchData:function(){m.a.fetch([{endpoint:this.getEndpoint("hashes"),dataKey:"merged",queryParams:this.props.location.query}])},handleCollapse:function(){m.a.collapseFingerprints()},handleUnmerge:function(){m.a.unmerge({groupId:this.props.params.groupId,loadingMessage:"".concat(Object(d.b)("Unmerging events"),"..."),successMessage:Object(d.b)("Events successfully queued for unmerging."),errorMessage:Object(d.b)("Unable to queue events for unmerging.")})},render:function(){var e=this.state.loading,t=this.state.error&&!e,r=!t&&!e;return Object(N.f)("div",null,Object(N.f)(p.b,{type:"warning"},Object(d.b)("This is an experimental feature. Data may not be immediately available while we process unmerges.")),e&&Object(N.f)(b.default,null),t&&Object(N.f)(h.a,{message:"Unable to load merged events, please try again later",onRetry:this.fetchData}),r&&Object(N.f)(le,{orgId:this.props.params.orgId,project:this.props.project,items:this.state.mergedItems,pageLinks:this.state.mergedLinks,onUnmerge:this.handleUnmerge,onToggleCollapse:m.a.toggleCollapseFingerprints}))}});t.default=pe}}]);
//# sourceMappingURL=GroupMerged.js.map