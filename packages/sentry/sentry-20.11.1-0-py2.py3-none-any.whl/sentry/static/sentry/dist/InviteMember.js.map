{"version":3,"sources":["webpack:///./app/views/settings/components/settingsPageHeader.tsx","webpack:///./app/components/radio.tsx","webpack:///./app/views/settings/components/teamSelect.jsx","webpack:///./app/views/settings/organizationMembers/inviteMember/roleSelect.tsx","webpack:///./app/views/settings/organizationMembers/inviteMember/index.jsx"],"names":["SettingsPageHeading","this","props","icon","title","action","tabs","noTitleStyles","TitleAndActions","Icon","Title","styled","Action","React","Component","defaultProps","p","space","StyledSettingsPageHeading","checkedCss","css","theme","green300","growIn","disabled","Radio","border","type","TeamSelect","state","loading","teams","fetchTeams","debounce","query","a","api","organization","requestPromise","slug","per_page","TEAMS_PER_PAGE","setState","DEFAULT_DEBOUNCE_DURATION","handleQueryUpdate","event","target","value","handleAddTeam","option","team","find","tm","onAddTeam","handleRemove","teamSlug","onRemoveTeam","options","selectedTeams","menuHeader","noTeams","length","isDisabled","filter","includes","map","searchKey","label","TeamDropdownElement","items","busyItemsStillVisible","onChange","onSelect","emptyMessage","t","alignMenu","isOpen","aria-label","size","confirmLastTeamRemoveMessage","confirmMessage","TeamRow","key","orgId","onRemove","hasButtons","renderTeamAddDropDown","renderBody","TeamPanelItem","StyledLink","to","message","bypass","onConfirm","isCircled","PanelItem","Link","withApi","Label","RoleSelect","enforceAllowed","roleList","selectedRole","role","desc","name","id","allowed","onClick","setRole","color","cursor","checked","readOnly","style","flex","padding","noMargin","className","InviteMember","redirectToMemberPage","params","router","pathToParentRoute","test","location","pathname","push","replaceRouterParams","splitEmails","text","split","e","trim","inviteUser","email","Promise","resolve","reject","request","method","data","Array","from","keys","referrer","success","addSuccessMessage","tct","error","err","status","addErrorMessage","responseJSON","submit","emails","busy","all","then","Sentry","scope","setExtra","Error","has","add","handleRemoveTeam","initialTeamSelection","Set","undefined","isSuperuser","ConfigStore","get","resp","roles","MEMBER_ROLES","invitesEnabled","getConfig","classNames","placeholder","spellCheck","v","values","priority","withRouter","withOrganization"],"mappings":"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","file":"InviteMember.js","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\nimport styled from '@emotion/styled';\n\nimport space from 'app/styles/space';\nimport {HeaderTitle} from 'app/styles/organization';\n\ntype Props = {\n  // The title\n  title: React.ReactNode;\n\n  // Disables font styles in the title. Allows for more custom titles.\n  noTitleStyles?: boolean;\n\n  className?: string;\n\n  // Icon left of title\n  icon?: React.ReactNode;\n\n  // Actions on opposite end of title bar from the title\n  action?: React.ReactNode;\n\n  tabs?: React.ReactNode;\n};\n\nclass SettingsPageHeading extends React.Component<Props> {\n  static propTypes = {\n    icon: PropTypes.node,\n    title: PropTypes.node.isRequired,\n    action: PropTypes.node,\n    tabs: PropTypes.node,\n    // Disables font styles in the title. Allows for more custom titles.\n    noTitleStyles: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    noTitleStyles: false,\n  };\n\n  render() {\n    const {icon, title, action, tabs, noTitleStyles, ...props} = this.props;\n    return (\n      <div {...props}>\n        <TitleAndActions>\n          {icon && <Icon>{icon}</Icon>}\n          {title && (\n            <Title tabs={tabs} styled={noTitleStyles}>\n              <HeaderTitle>{title}</HeaderTitle>\n            </Title>\n          )}\n          {action && <Action tabs={tabs}>{action}</Action>}\n        </TitleAndActions>\n\n        {tabs && <div>{tabs}</div>}\n      </div>\n    );\n  }\n}\n\ntype TitleProps = {\n  styled?: boolean;\n  tabs?: React.ReactNode;\n};\n\nconst TitleAndActions = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst Title = styled('div')<TitleProps & React.HTMLProps<HTMLDivElement>>`\n  ${p =>\n    !p.styled &&\n    `\n    font-size: 20px;\n    font-weight: bold;`};\n  margin: ${p =>\n    p.tabs\n      ? `${space(4)} ${space(2)} ${space(2)} 0`\n      : `${space(4)} ${space(2)} ${space(4)} 0`};\n  flex: 1;\n`;\n\nconst Icon = styled('div')`\n  margin-right: ${space(1)};\n`;\n\nconst Action = styled('div')<{tabs?: React.ReactNode}>`\n  ${p => (p.tabs ? `margin-top: ${space(2)}` : null)};\n`;\n\nconst StyledSettingsPageHeading = styled(SettingsPageHeading)<\n  Omit<React.HTMLProps<HTMLDivElement>, keyof Props> & Props\n>`\n  font-size: 14px;\n  margin-top: -${space(4)};\n`;\n\nexport default StyledSettingsPageHeading;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport {css} from '@emotion/core';\n\nimport {growIn} from 'app/styles/animations';\nimport {Theme} from 'app/utils/theme';\n\ntype CheckedProps = React.HTMLProps<HTMLInputElement> & {theme: Theme};\n\nconst checkedCss = (p: CheckedProps) => css`\n  display: block;\n  width: 1rem;\n  height: 1rem;\n  border-radius: 50%;\n  background-color: ${p.theme.green300};\n  animation: 0.2s ${growIn} ease;\n  opacity: ${p.disabled ? 0.4 : null};\n`;\n\nconst Radio = styled('input')`\n  display: flex;\n  padding: 0;\n  width: 1.5em;\n  height: 1.5em;\n  position: relative;\n  border-radius: 50%;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid ${p => p.theme.border};\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.04);\n  background: none;\n  appearance: none;\n\n  /* TODO(bootstrap): Our bootstrap CSS adds this, we can remove when we remove that */\n  margin: 0 !important;\n\n  &:focus,\n  &.focus-visible {\n    outline: none !important;\n    border: 1px solid ${p => p.theme.border};\n    box-shadow: rgba(209, 202, 216, 0.5) 0 0 0 3px;\n  }\n\n  &:checked:after {\n    content: '';\n    ${checkedCss}\n  }\n`;\n\nRadio.defaultProps = {\n  type: 'radio',\n};\n\nexport default Radio;\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport debounce from 'lodash/debounce';\nimport styled from '@emotion/styled';\n\nimport {DEFAULT_DEBOUNCE_DURATION, TEAMS_PER_PAGE} from 'app/constants';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'app/components/panels';\nimport {IconSubtract} from 'app/icons';\nimport {t} from 'app/locale';\nimport Button from 'app/components/button';\nimport Confirm from 'app/components/confirm';\nimport DropdownAutoComplete from 'app/components/dropdownAutoComplete';\nimport DropdownButton from 'app/components/dropdownButton';\nimport EmptyMessage from 'app/views/settings/components/emptyMessage';\nimport Link from 'app/components/links/link';\nimport SentryTypes from 'app/sentryTypes';\nimport space from 'app/styles/space';\nimport withApi from 'app/utils/withApi';\n\nclass TeamSelect extends React.Component {\n  static propTypes = {\n    api: PropTypes.object.isRequired,\n    organization: SentryTypes.Organization.isRequired,\n\n    /**\n     * Should button be disabled\n     */\n    disabled: PropTypes.bool,\n\n    /**\n     * Teams that are already selected.\n     */\n    selectedTeams: PropTypes.array.isRequired,\n    /**\n     * callback when teams are added\n     */\n    onAddTeam: PropTypes.func.isRequired,\n    /**\n     * Callback when teams are removed\n     */\n    onRemoveTeam: PropTypes.func.isRequired,\n\n    /**\n     * Optional menu header.\n     */\n    menuHeader: PropTypes.element,\n\n    /**\n     * Message to display when the last team is removed\n     * if empty no confirm will be displayed.\n     */\n    confirmLastTeamRemoveMessage: PropTypes.string,\n  };\n\n  state = {\n    loading: true,\n    teams: null,\n  };\n\n  componentDidMount() {\n    this.fetchTeams();\n  }\n\n  fetchTeams = debounce(async query => {\n    const {api, organization} = this.props;\n    const teams = await api.requestPromise(`/organizations/${organization.slug}/teams/`, {\n      query: {query, per_page: TEAMS_PER_PAGE},\n    });\n    this.setState({teams, loading: false});\n  }, DEFAULT_DEBOUNCE_DURATION);\n\n  handleQueryUpdate = event => {\n    this.setState({loading: true});\n    this.fetchTeams(event.target.value);\n  };\n\n  handleAddTeam = option => {\n    const team = this.state.teams.find(tm => tm.slug === option.value);\n    this.props.onAddTeam(team);\n  };\n\n  handleRemove = teamSlug => {\n    this.props.onRemoveTeam(teamSlug);\n  };\n\n  renderTeamAddDropDown() {\n    const {disabled, selectedTeams, menuHeader} = this.props;\n    const {teams} = this.state;\n    const noTeams = teams === null || teams.length === 0;\n    const isDisabled = disabled;\n\n    let options;\n    if (noTeams) {\n      options = [];\n    } else {\n      options = teams\n        .filter(team => !selectedTeams.includes(team.slug))\n        .map(team => ({\n          value: team.slug,\n          searchKey: team.slug,\n          label: <TeamDropdownElement>#{team.slug}</TeamDropdownElement>,\n        }));\n    }\n\n    return (\n      <DropdownAutoComplete\n        items={options}\n        busyItemsStillVisible={this.state.loading}\n        onChange={this.handleQueryUpdate}\n        onSelect={this.handleAddTeam}\n        emptyMessage={t('No teams')}\n        menuHeader={menuHeader}\n        disabled={isDisabled}\n        alignMenu=\"right\"\n      >\n        {({isOpen}) => (\n          <DropdownButton\n            aria-label={t('Add Team')}\n            isOpen={isOpen}\n            size=\"xsmall\"\n            disabled={isDisabled}\n          >\n            {t('Add Team')}\n          </DropdownButton>\n        )}\n      </DropdownAutoComplete>\n    );\n  }\n\n  renderBody() {\n    const {\n      organization,\n      selectedTeams,\n      disabled,\n      confirmLastTeamRemoveMessage,\n    } = this.props;\n\n    if (selectedTeams.length === 0) {\n      return <EmptyMessage>{t('No Teams assigned')}</EmptyMessage>;\n    }\n    const confirmMessage =\n      selectedTeams.length === 1 && confirmLastTeamRemoveMessage\n        ? confirmLastTeamRemoveMessage\n        : null;\n\n    return selectedTeams.map(team => (\n      <TeamRow\n        key={team}\n        orgId={organization.slug}\n        team={team}\n        onRemove={this.handleRemove}\n        disabled={disabled}\n        confirmMessage={confirmMessage}\n      />\n    ));\n  }\n\n  render() {\n    return (\n      <Panel>\n        <PanelHeader hasButtons>\n          {t('Team')}\n          {this.renderTeamAddDropDown()}\n        </PanelHeader>\n\n        <PanelBody>{this.renderBody()}</PanelBody>\n      </Panel>\n    );\n  }\n}\n\nconst TeamRow = props => {\n  const {orgId, team, onRemove, disabled, confirmMessage} = props;\n  return (\n    <TeamPanelItem>\n      <StyledLink to={`/settings/${orgId}/teams/${team}/`}>{`#${team}`}</StyledLink>\n      <Confirm\n        message={confirmMessage}\n        bypass={!confirmMessage}\n        onConfirm={() => onRemove(team)}\n        disabled={disabled}\n      >\n        <Button\n          size=\"xsmall\"\n          icon={<IconSubtract isCircled size=\"xs\" />}\n          disabled={disabled}\n        >\n          {t('Remove')}\n        </Button>\n      </Confirm>\n    </TeamPanelItem>\n  );\n};\n\nTeamRow.propTypes = {\n  disabled: PropTypes.bool,\n  team: PropTypes.string.isRequired,\n  orgId: PropTypes.string.isRequired,\n  onRemove: PropTypes.func.isRequired,\n  confirmMessage: PropTypes.string,\n};\n\nconst TeamDropdownElement = styled('div')`\n  padding: ${space(0.5)} 0px;\n  text-transform: none;\n`;\n\nconst TeamPanelItem = styled(PanelItem)`\n  padding: ${space(2)};\n  align-items: center;\n`;\n\nconst StyledLink = styled(Link)`\n  flex: 1;\n  margin-right: ${space(1)};\n`;\n\nexport default withApi(TeamSelect);\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport styled from '@emotion/styled';\n\nimport {MemberRole} from 'app/types';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'app/components/panels';\nimport {t} from 'app/locale';\nimport Radio from 'app/components/radio';\nimport TextBlock from 'app/views/settings/components/text/textBlock';\n\nconst Label = styled('label')`\n  display: flex;\n  flex: 1;\n  align-items: center;\n  margin-bottom: 0;\n`;\n\ntype Props = {\n  enforceAllowed: boolean;\n  disabled: boolean;\n  selectedRole: string;\n  roleList: MemberRole[];\n  setRole: (id: string) => void;\n};\n\nclass RoleSelect extends React.Component<Props> {\n  static propTypes = {\n    /**\n     * Whether to disable or not using `allowed` prop from API request\n     */\n    enforceAllowed: PropTypes.bool,\n    disabled: PropTypes.bool,\n    selectedRole: PropTypes.string,\n    roleList: PropTypes.array,\n    setRole: PropTypes.func,\n  };\n\n  render() {\n    const {disabled, enforceAllowed, roleList, selectedRole} = this.props;\n\n    return (\n      <Panel>\n        <PanelHeader>{t('Role')}</PanelHeader>\n\n        <PanelBody>\n          {roleList.map(role => {\n            const {desc, name, id, allowed} = role;\n            const isDisabled = disabled || (enforceAllowed && !allowed);\n            return (\n              <PanelItem\n                key={id}\n                onClick={() => !isDisabled && this.props.setRole(id)}\n                css={!isDisabled ? {} : {color: 'grey', cursor: 'default'}}\n              >\n                <Label>\n                  <Radio id={id} value={name} checked={id === selectedRole} readOnly />\n                  <div style={{flex: 1, padding: '0 16px'}}>\n                    {name}\n                    <TextBlock noMargin>\n                      <div className=\"help-block\">{desc}</div>\n                    </TextBlock>\n                  </div>\n                </Label>\n              </PanelItem>\n            );\n          })}\n        </PanelBody>\n      </Panel>\n    );\n  }\n}\n\nexport default RoleSelect;\n","import {withRouter} from 'react-router';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport classNames from 'classnames';\nimport * as Sentry from '@sentry/react';\n\nimport {addErrorMessage, addSuccessMessage} from 'app/actionCreators/indicator';\nimport {MEMBER_ROLES} from 'app/constants';\nimport {t, tct} from 'app/locale';\nimport withApi from 'app/utils/withApi';\nimport withOrganization from 'app/utils/withOrganization';\nimport SentryTypes from 'app/sentryTypes';\nimport Button from 'app/components/button';\nimport ConfigStore from 'app/stores/configStore';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport TextBlock from 'app/views/settings/components/text/textBlock';\nimport TextField from 'app/components/forms/textField';\nimport TeamSelect from 'app/views/settings/components/teamSelect';\nimport replaceRouterParams from 'app/utils/replaceRouterParams';\n\nimport RoleSelect from './roleSelect';\n\nclass InviteMember extends React.Component {\n  static propTypes = {\n    api: PropTypes.object,\n    organization: SentryTypes.Organization.isRequired,\n    router: PropTypes.object,\n  };\n\n  constructor(props) {\n    super(props);\n    const {teams} = props.organization;\n    //select team if there's only one\n    const initialTeamSelection = teams.length === 1 ? [teams[0].slug] : [];\n\n    this.state = {\n      selectedTeams: new Set(initialTeamSelection),\n      roleList: [],\n      selectedRole: 'member',\n      email: '',\n      loading: true,\n      busy: false,\n      error: undefined,\n    };\n  }\n\n  componentDidMount() {\n    const {slug} = this.props.organization;\n    const {isSuperuser} = ConfigStore.get('user');\n\n    this.props.api.request(`/organizations/${slug}/members/me/`, {\n      method: 'GET',\n      success: resp => {\n        const {roles} = resp || {};\n\n        if (!resp || !roles) {\n          this.setState({\n            loading: false,\n            error: {\n              role: 'Error loading roles, will default to \"member\"',\n            },\n          });\n\n          Sentry.withScope(scope => {\n            scope.setExtra('resp', resp);\n            scope.setExtra('state', this.state);\n            Sentry.captureException(new Error('[members]: data fetch invalid response'));\n          });\n        } else {\n          this.setState({roleList: roles, loading: false});\n\n          if (roles.filter(({allowed}) => allowed).length === 0) {\n            // not allowed to invite, redirect\n            this.redirectToMemberPage();\n          }\n        }\n      },\n      error: error => {\n        if (error.status === 404 && isSuperuser) {\n          // use the static list\n          this.setState({roleList: MEMBER_ROLES, loading: false});\n        } else if (error.status !== 0) {\n          Sentry.withScope(scope => {\n            scope.setExtra('error', error);\n            scope.setExtra('state', this.state);\n            Sentry.captureException(new Error('[members]: data fetch error'));\n          });\n        }\n\n        addErrorMessage(t('Error with request, please reload'));\n      },\n    });\n  }\n\n  redirectToMemberPage = () => {\n    // Get path to parent route (`/organizations/${slug}/members/`)\n    // `recreateRoute` fucks up because of getsentry hooks\n    const {params, router} = this.props;\n    const isNewSettings = /^\\/settings\\//.test(router.location.pathname);\n    const pathToParentRoute = isNewSettings\n      ? '/settings/:orgId/members/'\n      : '/organizations/:orgId/members/';\n    router.push(replaceRouterParams(pathToParentRoute, params));\n  };\n\n  splitEmails = text =>\n    text\n      .split(',')\n      .map(e => e.trim())\n      .filter(e => e);\n\n  inviteUser = email => {\n    const {slug} = this.props.organization;\n    const {selectedTeams, selectedRole} = this.state;\n\n    return new Promise((resolve, reject) => {\n      this.props.api.request(`/organizations/${slug}/members/`, {\n        method: 'POST',\n        data: {\n          email,\n          teams: Array.from(selectedTeams.keys()),\n          role: selectedRole,\n          referrer: this.props.location.query.referrer,\n        },\n        success: () => {\n          addSuccessMessage(\n            tct('Added [email] to [organization]', {\n              email,\n              organization: slug,\n            })\n          );\n          resolve();\n        },\n        error: err => {\n          if (err.status === 403) {\n            addErrorMessage(t(\"You aren't allowed to invite members.\"));\n            resolve();\n          } else if (err.status === 409) {\n            addErrorMessage(`User already exists: ${email}`);\n            resolve();\n          } else {\n            reject(err.responseJSON);\n          }\n        },\n      });\n    });\n  };\n\n  submit = () => {\n    const {email} = this.state;\n    const emails = this.splitEmails(email);\n    if (!emails.length) {\n      return;\n    }\n    this.setState({busy: true});\n    Promise.all(emails.map(this.inviteUser))\n      .then(() => this.redirectToMemberPage())\n      .catch(error => {\n        if (error && !error.email && !error.role) {\n          Sentry.withScope(scope => {\n            scope.setExtra('error', error);\n            scope.setExtra('state', this.state);\n            Sentry.captureException(new Error('Unknown invite member api response'));\n          });\n        }\n        this.setState({error, busy: false});\n      });\n  };\n\n  handleAddTeam = team => {\n    const {selectedTeams} = this.state;\n    if (!selectedTeams.has(team.slug)) {\n      selectedTeams.add(team.slug);\n    }\n    this.setState({selectedTeams});\n  };\n\n  handleRemoveTeam = teamSlug => {\n    const {selectedTeams} = this.state;\n    selectedTeams.delete(teamSlug);\n\n    this.setState({selectedTeams});\n  };\n\n  render() {\n    const {error, loading, roleList, selectedRole, selectedTeams} = this.state;\n    const {organization} = this.props;\n    const {invitesEnabled} = ConfigStore.getConfig();\n    const {isSuperuser} = ConfigStore.get('user');\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('Add Member to Organization')} />\n        <TextBlock>\n          {invitesEnabled\n            ? t(\n                'Invite a member to join this organization via their email address. If they do not already have an account, they will first be asked to create one. Multiple emails delimited by commas.'\n              )\n            : t(\n                'You may add a user by their username if they already have an account. Multiple inputs delimited by commas.'\n              )}\n        </TextBlock>\n\n        {loading && <LoadingIndicator />}\n        {!loading && (\n          <div>\n            <div className={classNames({'has-error': error && error.email})}>\n              <TextField\n                name=\"email\"\n                label={invitesEnabled ? t('Email') + '(s)' : t('Username') + '(s)'}\n                placeholder=\"e.g. teammate@example.com\"\n                spellCheck=\"false\"\n                onChange={v => this.setState({email: v})}\n              />\n              {error && error.email && <p className=\"error\">{error.email}</p>}\n            </div>\n            {error && error.role && <p className=\"error alert-error\">{error.role}</p>}\n            <RoleSelect\n              enforceAllowed={!isSuperuser}\n              roleList={roleList}\n              selectedRole={selectedRole}\n              setRole={slug => this.setState({selectedRole: slug})}\n            />\n            <TeamSelect\n              organization={organization}\n              selectedTeams={Array.from(selectedTeams.values())}\n              onAddTeam={this.handleAddTeam}\n              onRemoveTeam={this.handleRemoveTeam}\n            />\n            <Button\n              priority=\"primary\"\n              busy={this.state.busy}\n              className=\"invite-member-submit\"\n              onClick={this.submit}\n            >\n              {t('Add Member')}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport {InviteMember};\nexport default withApi(withRouter(withOrganization(InviteMember)));\n"],"sourceRoot":""}