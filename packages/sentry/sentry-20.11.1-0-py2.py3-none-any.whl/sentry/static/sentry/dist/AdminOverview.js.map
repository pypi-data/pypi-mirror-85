{"version":3,"sources":["webpack:///./app/views/admin/adminOverview/apiChart.jsx","webpack:///./app/views/admin/adminOverview/eventChart.jsx","webpack:///./app/views/admin/adminOverview/index.tsx"],"names":["ApiChart","state","getInitialState","fetchData","forEach","statName","props","api","request","method","data","since","resolution","key","success","setState","prevState","rawData","requestFinished","error","processOrgData","loading","this","nextProps","series","map","item","name","value","seriesName","processRawSeries","color","theme","green200","blue300","red200","onRetry","getChartSeries","colors","height","stacked","isGroupedByDate","showTimeInTooltip","labelYAxisExtents","React","Component","withApi","EventChart","stats","received","rejected","sReceived","sRejected","aReceived","point","idx","dReceived","dRejected","ts","undefined","Object","keys","accepted","t","AdminOverview","Date","getTime","title","Fragment","withPadding"],"mappings":"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","file":"AdminOverview.js","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\n\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport MiniBarChart from 'app/components/charts/miniBarChart';\nimport withApi from 'app/utils/withApi';\nimport theme from 'app/utils/theme';\n\nclass ApiChart extends React.Component {\n  static propTypes = {\n    api: PropTypes.object.isRequired,\n    since: PropTypes.number.isRequired,\n    resolution: PropTypes.string.isRequired,\n  };\n\n  state = this.getInitialState();\n\n  getInitialState() {\n    return {\n      error: false,\n      loading: true,\n      rawData: {\n        'client-api.all-versions.responses.2xx': null,\n        'client-api.all-versions.responses.4xx': null,\n        'client-api.all-versions.responses.5xx': null,\n      },\n    };\n  }\n\n  componentWillMount() {\n    this.fetchData();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.since !== nextProps.since) {\n      this.setState(this.getInitialState(), this.fetchData);\n    }\n  }\n\n  fetchData = () => {\n    const statNameList = [\n      'client-api.all-versions.responses.2xx',\n      'client-api.all-versions.responses.4xx',\n      'client-api.all-versions.responses.5xx',\n    ];\n\n    statNameList.forEach(statName => {\n      this.props.api.request('/internal/stats/', {\n        method: 'GET',\n        data: {\n          since: this.props.since,\n          resolution: this.props.resolution,\n          key: statName,\n        },\n        success: data => {\n          this.setState(prevState => {\n            const rawData = prevState.rawData;\n            rawData[statName] = data;\n            return {\n              rawData,\n            };\n          }, this.requestFinished);\n        },\n        error: () => {\n          this.setState({\n            error: true,\n          });\n        },\n      });\n    });\n  };\n\n  requestFinished = () => {\n    const {rawData} = this.state;\n    if (rawData['events.total'] && rawData['events.dropped']) {\n      this.processOrgData();\n    }\n    if (\n      rawData['client-api.all-versions.responses.2xx'] &&\n      rawData['client-api.all-versions.responses.4xx'] &&\n      rawData['client-api.all-versions.responses.5xx']\n    ) {\n      this.setState({\n        loading: false,\n      });\n    }\n  };\n\n  processRawSeries(series) {\n    return series.map(item => ({name: item[0] * 1000, value: item[1]}));\n  }\n\n  getChartSeries() {\n    const {rawData} = this.state;\n    return [\n      {\n        seriesName: '2xx',\n        data: this.processRawSeries(rawData['client-api.all-versions.responses.2xx']),\n        color: theme.green200,\n      },\n      {\n        seriesName: '4xx',\n        data: this.processRawSeries(rawData['client-api.all-versions.responses.4xx']),\n        color: theme.blue300,\n      },\n      {\n        seriesName: '5xx',\n        data: this.processRawSeries(rawData['client-api.all-versions.responses.5xx']),\n        color: theme.red200,\n      },\n    ];\n  }\n\n  render() {\n    const {loading, error} = this.state;\n    if (loading) {\n      return <LoadingIndicator />;\n    } else if (error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n\n    const series = this.getChartSeries();\n    const colors = series.map(({color}) => color);\n    return (\n      <MiniBarChart\n        series={series}\n        colors={colors}\n        height={110}\n        stacked\n        isGroupedByDate\n        showTimeInTooltip\n        labelYAxisExtents\n      />\n    );\n  }\n}\n\nexport default withApi(ApiChart);\n","import PropTypes from 'prop-types';\nimport React from 'react';\n\nimport MiniBarChart from 'app/components/charts/miniBarChart';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport {t} from 'app/locale';\nimport withApi from 'app/utils/withApi';\nimport theme from 'app/utils/theme';\n\nclass EventChart extends React.Component {\n  static propTypes = {\n    api: PropTypes.object.isRequired,\n    since: PropTypes.number.isRequired,\n    resolution: PropTypes.string.isRequired,\n  };\n\n  state = this.getInitialState();\n\n  getInitialState() {\n    return {\n      error: false,\n      loading: true,\n      rawData: {\n        'events.total': null,\n        'events.dropped': null,\n      },\n      stats: {received: [], rejected: []},\n    };\n  }\n\n  componentWillMount() {\n    this.fetchData();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.since !== nextProps.since) {\n      this.setState(this.getInitialState(), this.fetchData);\n    }\n  }\n\n  fetchData = () => {\n    const statNameList = ['events.total', 'events.dropped'];\n\n    statNameList.forEach(statName => {\n      // query the organization stats via a separate call as its possible the project stats\n      // are too heavy\n      this.props.api.request('/internal/stats/', {\n        method: 'GET',\n        data: {\n          since: this.props.since,\n          resolution: this.props.resolution,\n          key: statName,\n        },\n        success: data => {\n          this.setState(prevState => {\n            const rawData = prevState.rawData;\n            rawData[statName] = data;\n            return {\n              rawData,\n            };\n          }, this.requestFinished);\n        },\n        error: () => {\n          this.setState({\n            error: true,\n          });\n        },\n      });\n    });\n  };\n\n  requestFinished() {\n    const {rawData} = this.state;\n    if (rawData['events.total'] && rawData['events.dropped']) {\n      this.processOrgData();\n    }\n  }\n\n  processOrgData() {\n    const {rawData} = this.state;\n    const sReceived = {};\n    const sRejected = {};\n    const aReceived = [0, 0]; // received, points\n\n    rawData['events.total'].forEach((point, idx) => {\n      const dReceived = point[1];\n      const dRejected = rawData['events.dropped'][idx][1];\n      const ts = point[0];\n      if (sReceived[ts] === undefined) {\n        sReceived[ts] = dReceived;\n        sRejected[ts] = dRejected;\n      } else {\n        sReceived[ts] += dReceived;\n        sRejected[ts] += dRejected;\n      }\n      if (dReceived > 0) {\n        aReceived[0] += dReceived;\n        aReceived[1] += 1;\n      }\n    });\n\n    this.setState({\n      stats: {\n        rejected: Object.keys(sRejected).map(ts => ({\n          name: ts * 1000,\n          value: sRejected[ts] || 0,\n        })),\n        accepted: Object.keys(sReceived).map(ts =>\n          // total number of events accepted (received - rejected)\n          ({name: ts * 1000, value: sReceived[ts] - sRejected[ts]})\n        ),\n      },\n      loading: false,\n    });\n  }\n\n  getChartSeries() {\n    const {stats} = this.state;\n\n    return [\n      {\n        seriesName: t('Accepted'),\n        data: stats.accepted,\n        color: theme.blue300,\n      },\n      {\n        seriesName: t('Dropped'),\n        data: stats.rejected,\n        color: theme.red200,\n      },\n    ];\n  }\n\n  render() {\n    const {loading, error} = this.state;\n    if (loading) {\n      return <LoadingIndicator />;\n    } else if (error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n    const series = this.getChartSeries();\n    const colors = series.map(({color}) => color);\n    return (\n      <MiniBarChart\n        series={series}\n        colors={colors}\n        height={110}\n        stacked\n        isGroupedByDate\n        showTimeInTooltip\n        labelYAxisExtents\n      />\n    );\n  }\n}\n\nexport default withApi(EventChart);\n","import React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport {Panel, PanelHeader, PanelBody} from 'app/components/panels';\nimport {t} from 'app/locale';\n\nimport ApiChart from './apiChart';\nimport EventChart from './eventChart';\n\nconst AdminOverview = () => {\n  const resolution = '1h';\n  const since = new Date().getTime() / 1000 - 3600 * 24 * 7;\n\n  return (\n    <DocumentTitle title=\"Admin Overview - Sentry\">\n      <React.Fragment>\n        <h3>{t('System Overview')}</h3>\n\n        <Panel key=\"events\">\n          <PanelHeader>{t('Event Throughput')}</PanelHeader>\n          <PanelBody withPadding>\n            <EventChart since={since} resolution={resolution} />\n          </PanelBody>\n        </Panel>\n\n        <Panel key=\"api\">\n          <PanelHeader>{t('API Responses')}</PanelHeader>\n          <PanelBody withPadding>\n            <ApiChart since={since} resolution={resolution} />\n          </PanelBody>\n        </Panel>\n      </React.Fragment>\n    </DocumentTitle>\n  );\n};\n\nexport default AdminOverview;\n"],"sourceRoot":""}