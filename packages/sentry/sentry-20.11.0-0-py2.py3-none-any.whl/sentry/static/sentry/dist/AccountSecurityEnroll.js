(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[38],{1985:function(t,e,n){"use strict";var r=n(10),a=n.n(r),o=n(11),c=n.n(o),i=n(12),u=n.n(i),s=n(13),l=n.n(s),f=n(7),p=n.n(f),d=n(4),h=n(1),b=n.n(h),m=n(40),y=n.n(m),O=n(685),v=n(420),j=n(31),g=n(302),S=n(16),k=n(0);function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=p()(t);if(e){var a=p()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return l()(this,n)}}var C=Object(d.a)("div",{target:"e1usehz70",label:"Wrapper"})({name:"k008qs",styles:"display:flex;"}),E=Object(d.a)("input",{target:"e1usehz71",label:"StyledInput"})(O.a,";background-color:",(function(t){return t.theme.backgroundSecondary}),";border-right-width:0;border-top-right-radius:0;border-bottom-right-radius:0;direction:",(function(t){return t.rtl?"rtl":"ltr"}),";&:hover,&:focus{background-color:",(function(t){return t.theme.backgroundSecondary}),";border-right-width:0;}"),w=Object(d.a)("div",{target:"e1usehz72",label:"OverflowContainer"})({name:"1owvqzu",styles:"flex-grow:1;border:none;"}),R=Object(d.a)(j.a,{target:"e1usehz73",label:"StyledCopyButton"})({name:"nfns8r",styles:"flex-shrink:1;border-radius:0 0.25em 0.25em 0;box-shadow:none;"}),P=function(t){u()(n,t);var e=x(n);function n(t){var r;return a()(this,n),(r=e.call(this,t)).handleCopyClick=function(t){if(r.textRef.current){var e=r.props.onCopy;r.handleSelectText(),e(r.props.children,t),t.stopPropagation()}},r.handleSelectText=function(){var t=r.props.rtl;if(r.textRef.current){var e=y.a.findDOMNode(r.textRef.current);t?e.setSelectionRange(1,e.value.length-1):Object(v.a)(e)}},r.textRef=b.a.createRef(),r}return c()(n,[{key:"render",value:function(){var t=this.props,e=t.style,n=t.children,r=t.rtl,a=r?"‪"+n+"‬":n;return Object(k.f)(C,null,Object(k.f)(w,null,Object(k.f)(E,{readOnly:!0,ref:this.textRef,style:e,value:a,onClick:this.handleSelectText,rtl:r})),Object(k.f)(g.a,{hideUnsupported:!0,onClick:this.handleCopyClick,value:n},Object(k.f)(R,{type:"button",size:"xsmall",onClick:this.handleCopyClick},Object(k.f)(S.q,null))))}}]),n}(b.a.Component);P.displayName="TextCopyInput",P.defaultProps={onCopy:function(){}},e.a=P},2990:function(t,e,n){"use strict";n.r(e);var r=n(37),a=n.n(r),o=n(22),c=n.n(o),i=n(29),u=n.n(i),s=n(10),l=n.n(s),f=n(11),p=n.n(f),d=n(12),h=n.n(d),b=n(13),m=n.n(b),y=n(7),O=n.n(y),v=n(6),j=n.n(v),g=n(27),S=n.n(g),k=n(9),x=n(1),C=n.n(x),E=n(185),w=n(32),R=n(100),P=n(428),T=n(3),D=n(1966),q=n(31),N=n(704),I=n(686),A=n(1980),_=n(1979),z=n(4),B=n(0),F=function(t){var e=t.code;return Object(B.f)(W,null,Object(B.f)("tbody",null,e.map((function(t,e){return Object(B.f)("tr",{key:e},t.map((function(t,e){return t?Object(B.f)(U,{key:e}):Object(B.f)(J,{key:e})})))}))))};F.displayName="Qrcode";var M=Object(z.a)("td",{target:"e8bpnt20",label:"Cell"})({name:"1c97kwh",styles:"height:6px;width:6px;padding:0;"}),U=Object(z.a)(M,{target:"e8bpnt21",label:"BlackCell"})({name:"1qzfsby",styles:"background-color:black;"}),J=Object(z.a)(M,{target:"e8bpnt22",label:"WhiteCell"})({name:"cxmp86",styles:"background-color:white;"}),W=Object(z.a)("table",{target:"e8bpnt23",label:"Table"})({name:"1uk1gs8",styles:"margin:0;"}),V=F,L=n(2231),Q=n(1968),G=n(683),H=n(1985),K=n(1121),X=n(2386);function Y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return m()(this,n)}}function Z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(n),!0).forEach((function(e){j()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var tt={name:"1v994a0",styles:"margin-right:6px;"},et={name:"1ttqh2b-AccountSecurityEnroll",styles:"margin-left:6px;;label:AccountSecurityEnroll;"},nt=function(t){h()(r,t);var e,n=Y(r);function r(){var t;l()(this,r);for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(t=n.call.apply(n,[this].concat(a)))._form={},t.handleFieldChange=function(e,n){t._form[e]=n},t.handleSmsReset=function(){return t.setState({hasSentCode:!1},t.remountComponent)},t.handleSmsSubmit=u()(c.a.mark((function e(){var n,r,a,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=n.authenticator,a=n.hasSentCode,t._form.phone){e.next=3;break}return e.abrupt("return");case 3:return o={phone:t._form.phone,otp:a?t._form.otp||"":void 0,secret:r.secret},t.setState({loading:a}),a||Object(w.c)(Object(T.b)("Sending code to %s...",o.phone)),e.prev=6,e.next=9,t.api.requestPromise(t.enrollEndpoint,{data:o});case 9:e.next=19;break;case 11:return e.prev=11,e.t0=e.catch(6),t._form={},i="sms"===r.id,t.setState({hasSentCode:!i}),t.remountComponent(),Object(w.a)(t.state.hasSentCode?Object(T.b)("Incorrect OTP"):Object(T.b)("Error sending SMS")),e.abrupt("return");case 19:a?t.handleEnrollSuccess():(t.setState({hasSentCode:!0,loading:!1}),Object(w.c)(Object(T.b)("Sent code to %s",o.phone)));case 20:case"end":return e.stop()}}),e,null,[[6,11]])}))),t.handleU2fTap=function(){var e=u()(c.a.mark((function e(n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$($({},n),t._form),t.setState({loading:!0}),e.prev=2,e.next=5,t.api.requestPromise(t.enrollEndpoint,{data:r});case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),t.handleEnrollError(),e.abrupt("return");case 11:t.handleEnrollSuccess();case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),t.handleTotpSubmit=function(){var e=u()(c.a.mark((function e(n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$($($({},t._form),n||{}),{},{secret:t.state.authenticator.secret}),t.setState({loading:!0}),e.prev=2,e.next=5,t.api.requestPromise(t.enrollEndpoint,{method:"POST",data:r});case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),t.handleEnrollError(),e.abrupt("return");case 11:t.handleEnrollSuccess();case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),t.handleRemove=u()(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.state.authenticator)&&n.authId){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.api.requestPromise(t.authenticatorEndpoint,{method:"DELETE"});case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),Object(w.a)(Object(T.b)("Error removing authenticator")),e.abrupt("return");case 12:t.props.router.push("/settings/account/security/"),Object(w.d)(Object(T.b)("Authenticator has been removed"));case 14:case"end":return e.stop()}}),e,null,[[3,8]])}))),t}return p()(r,[{key:"getTitle",value:function(){return Object(T.b)("Security")}},{key:"getEndpoints",value:function(){var t=this;return[["authenticator",this.enrollEndpoint,{},{allowError:function(e){var n=e&&400===e.status&&e.responseJSON&&"Already enrolled"===e.responseJSON.details;return n&&(t.props.router.push("/settings/account/security/"),Object(w.a)(Object(T.b)("Already enrolled"))),n}}]]}},{key:"componentDidMount",value:function(){this.pendingInvitation=Object(X.a)()}},{key:"handleEnrollSuccess",value:(e=u()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.pendingInvitation){t.next=3;break}return t.next=3,Object(P.b)(this.pendingInvitation.memberId,{addOrg:!0,fetchOrgDetails:!0});case 3:this.props.router.push("/settings/account/security/"),Object(R.j)({authenticatorName:this.authenticatorName});case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"handleEnrollError",value:function(){this.setState({loading:!1}),Object(w.a)(Object(T.b)("Error adding %s authenticator",this.authenticatorName))}},{key:"renderBody",value:function(){var t=this.state,e=t.authenticator,n=t.hasSentCode;if(!e)return null;var r=function(t){var e=t.authenticator,n=t.hasSentCode,r=t.onSmsReset,a=t.onSmsSubmit,o=t.onU2fTap,c=e||{},i=c.form,u=c.qrcode,s=c.challenge,l=c.id;return i?u?[function(){return Object(B.f)(E.f,{key:"qrcode",justifyContent:"center",p:2},Object(B.f)(V,{code:e.qrcode}))},function(){return Object(B.f)(I.a,{key:"secret",label:Object(T.b)("Authenticator secret")},Object(B.f)(H.a,null,e.secret))}].concat(S()(i),[function(){return Object(B.f)(E.f,{key:"confirm",justifyContent:"flex-end",p:2},Object(B.f)(q.a,{priority:"primary",type:"submit"},Object(T.b)("Confirm")))}]):"sms"===l?[$($({},i[0]),{},{disabled:function(){return n}}),$($({},i[1]),{},{required:!0,visible:function(){return n}}),function(){return Object(B.f)(E.f,{key:"sms-footer",justifyContent:"flex-end",p:2,pr:"36px"},n&&Object(B.f)(q.a,{css:tt,onClick:r},Object(T.b)("Start Over")),Object(B.f)(q.a,{priority:"primary",type:"button",onClick:a},n?Object(T.b)("Confirm"):Object(T.b)("Send Code")))}]:"u2f"===l?[i.find((function(t){return"deviceName"===t.name})),function(){return Object(B.f)(K.default,{key:"u2f-enroll",style:{marginBottom:0},challengeData:s,displayMode:"enroll",flowMode:"enroll",onTap:o})}]:null:null}({authenticator:e,hasSentCode:n,onSmsReset:this.handleSmsReset,onSmsSubmit:this.handleSmsSubmit,onU2fTap:this.handleU2fTap}),o=r?r.filter((function(t){return void 0!==t.defaultValue})).map((function(t){return[t.name,t.defaultValue]})).reduce((function(t,e){var n=a()(e,2),r=n[0],o=n[1];return t[r]=o,t}),{}):{};return Object(B.f)(C.a.Fragment,null,Object(B.f)(Q.a,{title:Object(B.f)(C.a.Fragment,null,Object(B.f)("span",null,e.name),Object(B.f)(N.a,{css:et,enabled:e.isEnrolled})),action:e.isEnrolled&&e.removeButton&&Object(B.f)(L.a,{onConfirm:this.handleRemove},Object(B.f)(q.a,{priority:"danger"},e.removeButton))}),Object(B.f)(G.a,null,e.description),e.form&&!!e.form.length&&Object(B.f)(A.a,{apiMethod:"POST",onFieldChange:this.handleFieldChange,apiEndpoint:this.authenticatorEndpoint,onSubmit:this.handleTotpSubmit,initialData:$($({},o),e),hideFooter:!0},Object(B.f)(_.a,{forms:[{title:"Configuration",fields:r}]})))}},{key:"authenticatorEndpoint",get:function(){return"/users/me/authenticators/".concat(this.props.params.authId,"/")}},{key:"enrollEndpoint",get:function(){return"".concat(this.authenticatorEndpoint,"enroll/")}},{key:"authenticatorName",get:function(){var t=this.state.authenticator;return t&&t.name||"Authenticator"}}]),r}(D.a);e.default=Object(k.withRouter)(nt)}}]);
//# sourceMappingURL=AccountSecurityEnroll.js.map